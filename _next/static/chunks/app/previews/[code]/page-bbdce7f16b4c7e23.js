(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[224],{37017:(e,t,s)=>{"use strict";s.d(t,{$:()=>n});var r=s(61582);function n(e){let{variant:t="primary",size:s="md",className:n,...a}=e;return(0,r.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[--primary]"," ").concat({primary:"bg-[--primary] text-[--primary-foreground] hover:brightness-110 active:scale-[0.98]",secondary:"bg-[--background-subtle] text-[--foreground] hover:brightness-95 active:scale-[0.98]",ghost:"bg-transparent text-[--foreground-muted] hover:bg-[--background-subtle] hover:text-[--foreground] active:scale-[0.98]"}[t]," ").concat({sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-12 px-6 text-base",icon:"h-9 w-9 p-0"}[s]," ").concat(n),...a})}},50132:(e,t,s)=>{Promise.resolve().then(s.bind(s,60923))},60923:(e,t,s)=>{"use strict";s.d(t,{PreviewContent:()=>p});var r=s(61582),n=s(65310),a=s(77538),l=s(49090),i=s(15684),c=s.n(i);let o=null;function d(e){let{children:t,abilityName:a}=e,[l,i]=(0,n.useState)(null),[d,x]=(0,n.useState)(!0),[h,u]=(0,n.useState)(!1),[f,p]=(0,n.useState)({x:0,y:0,arrowOffset:0,isAbove:!0}),g=(0,n.useRef)(null),b=(0,n.useRef)(null);(0,n.useEffect)(()=>{!async function(){try{o||(o=(await s.e(638).then(s.t.bind(s,17638,19))).default);let e=o.find(e=>{let t=e.name.toLowerCase()===a.toLowerCase(),s=Array.isArray(e.alias)&&e.alias.some(e=>e.toLowerCase()===a.toLowerCase());return t||s});i((null==e?void 0:e.text)||null)}catch(e){console.error("加载异能说明失败:",e),i(null)}finally{x(!1)}}()},[a]);let j=()=>{if(!g.current||!b.current)return;let e=g.current.getBoundingClientRect(),t=b.current.getBoundingClientRect(),s=e.left,r=e.top-t.height-8,n=!0;r<8&&(r=e.bottom+8,n=!1),s+t.width>window.innerWidth-8&&(s=window.innerWidth-t.width-8),s<8&&(s=8);let a=Math.max(16,Math.min(e.left-s+e.width/2,t.width-16));return{x:s,y:r,arrowOffset:a,isAbove:n}};return((0,n.useEffect)(()=>{if(h){function e(){let e=j();e&&p(e)}return requestAnimationFrame(()=>{let e=j();e&&p(e)}),window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}}},[h]),d||!l)?(0,r.jsx)("span",{className:"inline",children:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{ref:g,className:"cursor-help border-b border-dotted border-[--muted-foreground] inline text-black dark:text-white font-medium",onMouseEnter:()=>{u(!0)},onMouseLeave:()=>u(!1),children:t}),h&&(0,r.jsx)("div",{ref:b,className:"fixed z-50 animate-in fade-in-0 zoom-in-95 max-w-[20rem]",style:{top:f.y,left:f.x,pointerEvents:"none",opacity:+(0!==f.x)},children:(0,r.jsxs)("div",{style:{"--arrow-offset":"".concat(f.arrowOffset||0,"px"),"--arrow-top":f.isAbove?"100%":"-6px","--arrow-transform":f.isAbove?"translateY(-50%) rotate(45deg)":"translateY(0) rotate(45deg)"},className:"jsx-aec5d3d40f67b896 rounded-lg bg-[--card] border border-[--border] shadow-lg relative after:absolute after:w-3 after:h-3 after:rotate-45 after:bg-[--card] after:border after:border-[--border]",children:[(0,r.jsx)("div",{className:"jsx-aec5d3d40f67b896 relative overflow-hidden rounded-lg px-3 py-2 text-sm text-[--foreground]",children:(0,r.jsx)("div",{className:"jsx-aec5d3d40f67b896 relative",children:(0,r.jsx)(m,{text:l||""})})}),(0,r.jsx)(c(),{id:"aec5d3d40f67b896",children:"div.jsx-aec5d3d40f67b896:after{left:var(--arrow-offset);top:var(--arrow-top);transform:var(--arrow-transform);border-right:none;border-bottom:none}"})]})})]})}function m(e){let{text:t,className:s="",renderCardRef:n}=e;if(n){let e,a=[],l=0,i=/`([^`]+)`/g;for(;null!==(e=i.exec(t));){if(e.index>l){let s=t.substring(l,e.index);a.push((0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:x(s)}},"text-".concat(a.length)))}if(e[1].match(/([^:]+):(\d+)/)){let t=n(e[1],a.length);t?a.push(t):a.push((0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:x(e[0])}},"text-".concat(a.length)))}else a.push((0,r.jsx)(d,{abilityName:e[1],children:e[1]},"ability-".concat(a.length)));l=e.index+e[0].length}return l<t.length&&a.push((0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:x(t.substring(l))}},"text-".concat(a.length))),(0,r.jsx)("span",{className:"inline ".concat(s),children:a})}return(0,r.jsx)("span",{className:"inline ".concat(s),dangerouslySetInnerHTML:{__html:x(t)}})}function x(e){return e.replace(/\{([^}]+)\}/g,(e,t)=>{if("T"===t||"Tap"===t||"tap"===t)return'<i class="ms ms-cost ms-tap align-text-bottom"></i>';if(t.includes("/")){let[e,s]=t.split("/");return'<i class="ms ms-cost ms-'.concat(e.toLowerCase()).concat(s.toLowerCase(),' align-text-bottom"></i>')}return'<i class="ms ms-cost ms-'.concat(t.toLowerCase(),' align-text-bottom"></i>')})}let h=e=>{let{level:t,textLines:s,pt:a,renderCardRef:l}=e;return(0,r.jsxs)("div",{className:"mt-2 flex items-center border-t border-[--border] pt-2",children:[(0,r.jsx)("div",{className:"mr-4 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-zinc-200/50 font-bold dark:bg-zinc-800/50",children:t}),(0,r.jsx)("div",{className:"flex-grow",children:s.map((e,t)=>(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(m,{text:e,renderCardRef:l}),t<s.length-1&&(0,r.jsx)("br",{})]},t))}),a&&(0,r.jsx)("div",{className:"ml-4 flex-shrink-0 rounded-md bg-zinc-200/50 px-3 py-1 font-semibold dark:bg-zinc-800/50",children:a})]})};function u(e){let t,s,{card:a,isEnglish:i,logoCode:c}=e,[o,d]=(0,n.useState)([]),[x,u]=(0,n.useState)([]),[f,p]=(0,n.useState)(!1),[g,b]=(0,n.useState)(!1),[j,v]=(0,n.useState)({x:0,y:0}),[w,N]=(0,n.useState)(null),[y,_]=(0,n.useState)(new Set),[k,C]=(0,n.useState)(!1),z=async e=>{if(!e.length)return[];try{let t=e.map(e=>{let[t,s]=e.split(":");return"(s=".concat(t," number=").concat(s,")")}).join(" or "),s=await fetch("https://mtgch.com/api/v1/result?q=".concat(encodeURIComponent(t),"&page=1&page_size=100&unique=oracle_id&priority_chinese=true"));if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));return(await s.json()).items.map(e=>({setCode:e.set,number:e.collector_number,zhs_name:e.atomic_official_name||e.atomic_translated_name||e.zhs_name||e.name}))}catch(t){return console.error("Failed to fetch card names:",t),e.map(e=>{let[t,s]=e.split(":");return{setCode:t,number:s}})}};(0,n.useEffect)(()=>{a.spellbook&&a.spellbook.length>0&&z(a.spellbook).then(d)},[a.spellbook]),(0,n.useEffect)(()=>{a.related&&a.related.length>0&&z(a.related).then(u)},[a.related]),(0,n.useEffect)(()=>{if(a.related&&a.related.length>0&&x.length>0){let e=new Set;(i?a.text:a.zhs_text).split("\n").forEach(t=>{let s,r=/`([^`]+)`/g;for(;null!==(s=r.exec(t));){let t=s[1].match(/([^:]+):(\d+)/);if(t){let s=parseInt(t[2],10);x[s]&&e.add(s)}}}),_(e)}},[a.related,a.text,a.zhs_text,x,i]);let L=(e,t)=>{let s=e.match(/([^:]+):(\d+)/);if(s){let[,e,n]=s,a=x[parseInt(n,10)];if(a)return(0,r.jsx)("a",{href:E(a.setCode,a.number),target:"_blank",rel:"noopener noreferrer",className:"text-[--primary] transition-opacity hover:opacity-80",onMouseEnter:()=>M(a),onMouseLeave:F,onMouseMove:I,children:e},t)}return null},S=e=>{let t=e.split("\n"),s=t.findIndex(e=>"FLAVOR"===e.trim()),a=s>=0?t.slice(0,s).join("\n"):e,l=s>=0?t.slice(s+1):[],i=a.split(/\n(?=STATION )/),c=i[0],o=i.slice(1),d=c.split("\n").map((e,t,s)=>(0,r.jsxs)("div",{className:"inline-block w-full",children:[(0,r.jsx)(m,{text:e,renderCardRef:L}),t<s.length-1&&(0,r.jsx)("br",{})]},t)),x=o.map((e,t)=>{let s=e.split("\n"),n=s[0].replace("STATION ",""),a=s.slice(1),l="";if(a.length>0){let e=a[a.length-1];/^\d+\/\d+$/.test(e)&&(l=a.pop())}return(0,r.jsx)(h,{level:n,textLines:a,pt:l,renderCardRef:L},t)}),u=l.length>0?(0,r.jsx)("div",{className:"mt-2 pt-2 border-t border-[--border] text-[--muted-foreground] italic",children:l.map((e,t)=>(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(m,{text:e,renderCardRef:L}),t<l.length-1&&(0,r.jsx)("br",{})]},"flavor-".concat(t)))}):null;return(0,r.jsxs)(r.Fragment,{children:[d,x,u]})},E=(e,t)=>{let s=/^(\d+)[ab]$/.test(t)?t.slice(0,-1):t;return"https://mtgch.com/card/".concat(e.toUpperCase(),"/").concat(s,"?utm_source=shiqidi")},M=e=>{N(e),b(!0)},F=()=>{b(!1),N(null)},I=e=>{let t=window.innerWidth,s=window.innerHeight,r=e.clientX+20,n=e.clientY-210;r+300>t-20&&(r=e.clientX-300-20),r<20&&(r=20),n<20&&(n=20),n+420>s-20&&(n=s-420-20),v({x:r,y:n})},T=(e,t)=>{let s=e.filter((e,t)=>!y.has(t));return 0===s.length?null:(0,r.jsxs)("div",{className:"mt-4 pt-2 border-t border-[--border]",children:[(0,r.jsx)("div",{className:"text-sm font-medium mb-2",children:t}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map((e,t)=>(0,r.jsx)("a",{href:E(e.setCode,e.number),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-[--primary] hover:opacity-80 transition-opacity",onMouseEnter:()=>M(e),onMouseLeave:F,onMouseMove:I,children:e.zhs_name||"".concat(e.setCode,":").concat(e.number)},t))})]})},A=k&&a.backface?a.backface:a;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-[--card] rounded-lg overflow-hidden border border-[--border] flex flex-col md:flex-row",children:[(0,r.jsx)("div",{className:"px-4 md:p-0 pt-4 md:pt-0",children:(0,r.jsxs)("div",{className:"relative w-full md:w-[300px] aspect-[488/680] md:h-[420px] bg-black mx-auto max-w-[300px] cursor-pointer",onClick:()=>p(!0),children:[(0,r.jsx)(l.default,{src:i?A.image_url_en:A.image_url_zh,alt:i?A.name:A.zhs_name,fill:!0,className:"object-cover",unoptimized:!0}),a.backface&&(0,r.jsx)("button",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center hover:bg-black/80 transition-colors",onClick:e=>{e.stopPropagation(),C(!k)},children:(0,r.jsxs)("svg",{className:"w-6 h-6",focusable:"false","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",children:[(0,r.jsx)("path",{fill:"currentColor",d:"M884.3,357.6c116.8,117.7,151.7,277-362.2,320V496.4L243.2,763.8L522,1031.3V860.8C828.8,839.4,1244.9,604.5,884.3,357.6z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M557.8,288.2v138.4l230.8-213.4L557.8,0v142.8c-309.2,15.6-792.1,253.6-426.5,503.8C13.6,527.9,30,330.1,557.8,288.2z"})]})})]})}),f&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>p(!1),children:(0,r.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"relative",style:{width:"min(85vw, 85vh * 488/680)",height:"min(85vh, 85vw * 680/488)"},children:(0,r.jsx)(l.default,{src:i?A.image_url_en:A.image_url_zh,alt:i?A.name:A.zhs_name,fill:!0,className:"object-contain",unoptimized:!0,sizes:"85vw"})}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[a.backface&&(0,r.jsx)("button",{className:"w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center hover:bg-black/80 transition-colors",onClick:()=>C(!k),children:(0,r.jsxs)("svg",{className:"w-6 h-6",focusable:"false","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",children:[(0,r.jsx)("path",{fill:"currentColor",d:"M884.3,357.6c116.8,117.7,151.7,277-362.2,320V496.4L243.2,763.8L522,1031.3V860.8C828.8,839.4,1244.9,604.5,884.3,357.6z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M557.8,288.2v138.4l230.8-213.4L557.8,0v142.8c-309.2,15.6-792.1,253.6-426.5,503.8C13.6,527.9,30,330.1,557.8,288.2z"})]})}),(0,r.jsx)("button",{className:"w-8 h-8 bg-black/60 text-white rounded-full flex items-center justify-center hover:bg-black/80",onClick:()=>p(!1),children:"✕"})]})]})}),(0,r.jsxs)("div",{className:"p-4 flex-1 flex flex-col min-w-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:(0,r.jsx)("div",{className:"font-medium break-words leading-none pt-0.5",children:A.zhs_name===A.name?(0,r.jsx)("h3",{children:A.name}):i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:A.name}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:A.zhs_name})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:A.zhs_name}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:A.name})]})})}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(m,{text:A.mana_cost})})]}),(0,r.jsxs)("div",{className:"mt-1 divide-y divide-[--border]",children:[(0,r.jsxs)("div",{className:"text-sm flex items-center justify-between",children:[(0,r.jsx)(m,{text:i?A.type:A.zhs_type}),(0,r.jsx)("i",{className:"ss ".concat((e=>{switch(e){case"mythic":return"ss-mythic";case"rare":return"ss-rare";case"uncommon":return"ss-uncommon";default:return"ss-common"}})(A.rarity)," ss-fw ss-3x ss-").concat(c)})]}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap pt-1 leading-normal",children:S(i?A.text:A.zhs_text)})]})]}),A.name2&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t-2 border-[--border]",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:(0,r.jsx)("div",{className:"font-medium break-words leading-none pt-0.5",children:A.zhs_name2===A.name2?(0,r.jsx)("h3",{children:A.name2}):i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:A.name2}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:A.zhs_name2})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:A.zhs_name2}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:A.name2})]})})}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(m,{text:A.mana_cost2||""})})]}),(0,r.jsxs)("div",{className:"mt-1 divide-y divide-[--border]",children:[(0,r.jsxs)("div",{className:"text-sm flex items-center justify-between",children:[(0,r.jsx)(m,{text:i?A.type2||"":A.zhs_type2||""}),(0,r.jsx)("i",{className:"ss ss-fw ss-3x ss-".concat(c," invisible")})]}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap pt-1 leading-normal",children:S(i?A.text2||"":A.zhs_text2||"")})]})]}),(0,r.jsxs)("div",{className:"mt-auto",children:[A.spellbook&&A.spellbook.length>0&&T(o,"法术书"),A.spellbook&&0===A.spellbook.length&&(0,r.jsxs)("div",{className:"mt-4 pt-2 border-t border-[--border]",children:[(0,r.jsx)("div",{className:"text-sm font-medium mb-2",children:"法术书"}),(0,r.jsx)("div",{className:"text-sm text-[--muted-foreground]",children:"暂未公布"})]}),A.related&&A.related.length>0&&T(x,"相关卡牌"),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1 mt-4 pt-2 border-t border-[--border]",children:[(0,r.jsxs)("div",{className:"text-xs text-[--muted-foreground] flex items-center gap-1",children:[(0,r.jsx)("i",{className:"ms ms-artist-nib ms-fw"}),(0,r.jsx)("span",{children:A.artist})]}),A.pow_tough&&(0,r.jsx)("div",{className:"text-sm font-medium",children:A.pow_tough})]})]})]})]}),g&&w&&(0,r.jsx)("div",{className:"fixed z-50 pointer-events-none",style:{left:j.x,top:j.y},children:(0,r.jsx)("div",{className:"relative bg-[--card] rounded-lg overflow-hidden shadow-xl border border-[--border]",children:(0,r.jsx)("div",{className:"w-[300px] aspect-[488/680]",children:(0,r.jsx)(l.default,{src:(t=w.setCode,s=w.number,"https://mtgch.com/image/large/".concat(t.toUpperCase(),"/").concat(t.toUpperCase(),"_").concat(s,".jpg")),alt:w.zhs_name||"".concat(w.setCode,":").concat(w.number),fill:!0,className:"object-contain",unoptimized:!0,onError:e=>{let t=e.target;t.src.includes("scryfall.io")||fetch("https://mtgch.com/api/v1/card/".concat(w.setCode.toUpperCase(),"/").concat(w.number)).then(e=>e.json()).then(e=>{if(null==e?void 0:e.id){let s=e.id;t.src="https://cards.scryfall.io/large/front/".concat(s.slice(0,1),"/").concat(s.slice(1,2),"/").concat(s,".jpg")}else t.src="/image/back.png"}).catch(()=>{t.src="/image/back.png"})}})})})})]})}var f=s(37017);function p(e){let{previewData:t,setName:s,isReleased:l}=e,[i,c]=(0,n.useState)(!1);return(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-[1400px] mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsxs)("h1",{className:"text-2xl font-bold",children:[s,"预览",l&&(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs bg-[--primary] text-[--primary-foreground] rounded ml-2 align-middle",children:"已上线"})]})}),(0,r.jsxs)(f.$,{variant:"secondary",onClick:()=>c(!i),className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(a.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"中/英切换"})]})]}),(0,r.jsxs)("div",{className:"bg-[--card] rounded-lg mb-8",children:[(0,r.jsx)("div",{className:"p-4",children:(0,r.jsx)("p",{className:"text-sm text-[--muted-foreground] leading-relaxed",children:t.description})}),(0,r.jsxs)("div",{className:"px-4 py-1.5 border-t border-[--border] flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-xs text-[--muted-foreground] min-w-[80px]",children:t.total_cards&&t.cards.length===t.total_cards?"共 ".concat(t.total_cards," 张卡牌"):"".concat(t.cards.length,"/").concat(t.total_cards||"?"," 张卡牌")}),(0,r.jsx)("div",{className:"flex-1 h-1 bg-[--border] rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[--primary] transition-all duration-500",style:{width:"".concat(t.cards.length/(t.total_cards||t.cards.length)*100,"%")}})})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.cards.sort((e,s)=>{let r=t.total_cards&&t.cards.length===t.total_cards,n=parseInt(e.id.split("-")[1]),a=parseInt(s.id.split("-")[1]);return r?n-a:a-n}).map(e=>(0,r.jsx)(u,{card:e,isEnglish:i,logoCode:t.logo_code},e.id))})]})})}}},e=>{e.O(0,[90,909,845,264,358],()=>e(e.s=50132)),_N_E=e.O()}]);
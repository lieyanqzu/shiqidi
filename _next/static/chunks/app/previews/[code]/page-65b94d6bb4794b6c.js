(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[224],{28927:(e,t,s)=>{Promise.resolve().then(s.bind(s,87469))},85192:(e,t,s)=>{"use strict";s.d(t,{$:()=>a});var r=s(59621);function a(e){let{variant:t="primary",size:s="md",className:a,...n}=e;return(0,r.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[--primary]"," ").concat({primary:"bg-[--primary] text-[--primary-foreground] hover:brightness-110 active:scale-[0.98]",secondary:"bg-[--background-subtle] text-[--foreground] hover:brightness-95 active:scale-[0.98]",ghost:"bg-transparent text-[--foreground-muted] hover:bg-[--background-subtle] hover:text-[--foreground] active:scale-[0.98]"}[t]," ").concat({sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-12 px-6 text-base",icon:"h-9 w-9 p-0"}[s]," ").concat(a),...n})}},87469:(e,t,s)=>{"use strict";s.d(t,{PreviewContent:()=>f});var r=s(59621),a=s(75809),n=s(4180),l=s(97898),i=s(75813),o=s.n(i);let c=null;function d(e){let{children:t,abilityName:n}=e,[l,i]=(0,a.useState)(null),[d,x]=(0,a.useState)(!0),[h,u]=(0,a.useState)(!1),[f,p]=(0,a.useState)({x:0,y:0,arrowOffset:0,isAbove:!0}),g=(0,a.useRef)(null),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{!async function(){try{c||(c=(await s.e(638).then(s.t.bind(s,17638,19))).default);let e=c.find(e=>{let t=e.name.toLowerCase()===n.toLowerCase(),s=Array.isArray(e.alias)&&e.alias.some(e=>e.toLowerCase()===n.toLowerCase());return t||s});i((null==e?void 0:e.text)||null)}catch(e){console.error("加载异能说明失败:",e),i(null)}finally{x(!1)}}()},[n]);let v=()=>{if(!g.current||!b.current)return;let e=g.current.getBoundingClientRect(),t=b.current.getBoundingClientRect(),s=e.left,r=e.top-t.height-8,a=!0;r<8&&(r=e.bottom+8,a=!1),s+t.width>window.innerWidth-8&&(s=window.innerWidth-t.width-8),s<8&&(s=8);let n=Math.max(16,Math.min(e.left-s+e.width/2,t.width-16));return{x:s,y:r,arrowOffset:n,isAbove:a}};return((0,a.useEffect)(()=>{if(h){function e(){let e=v();e&&p(e)}return requestAnimationFrame(()=>{let e=v();e&&p(e)}),window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}}},[h]),d||!l)?(0,r.jsx)("span",{className:"inline",children:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{ref:g,className:"cursor-help border-b border-dotted border-[--muted-foreground] inline text-black dark:text-white font-medium",onMouseEnter:()=>{u(!0)},onMouseLeave:()=>u(!1),children:t}),h&&(0,r.jsx)("div",{ref:b,className:"fixed z-50 animate-in fade-in-0 zoom-in-95 max-w-[20rem]",style:{top:f.y,left:f.x,pointerEvents:"none",opacity:+(0!==f.x)},children:(0,r.jsxs)("div",{style:{"--arrow-offset":"".concat(f.arrowOffset||0,"px"),"--arrow-top":f.isAbove?"100%":"-6px","--arrow-transform":f.isAbove?"translateY(-50%) rotate(45deg)":"translateY(0) rotate(45deg)"},className:"jsx-aec5d3d40f67b896 rounded-lg bg-[--card] border border-[--border] shadow-lg relative after:absolute after:w-3 after:h-3 after:rotate-45 after:bg-[--card] after:border after:border-[--border]",children:[(0,r.jsx)("div",{className:"jsx-aec5d3d40f67b896 relative overflow-hidden rounded-lg px-3 py-2 text-sm text-[--foreground]",children:(0,r.jsx)("div",{className:"jsx-aec5d3d40f67b896 relative",children:(0,r.jsx)(m,{text:l||""})})}),(0,r.jsx)(o(),{id:"aec5d3d40f67b896",children:"div.jsx-aec5d3d40f67b896:after{left:var(--arrow-offset);top:var(--arrow-top);-webkit-transform:var(--arrow-transform);-moz-transform:var(--arrow-transform);-ms-transform:var(--arrow-transform);-o-transform:var(--arrow-transform);transform:var(--arrow-transform);border-right:none;border-bottom:none}"})]})})]})}function m(e){let{text:t,className:s="",renderCardRef:a}=e;if(a){let e,n=[],l=0,i=/`([^`]+)`/g;for(;null!==(e=i.exec(t));){if(e.index>l){let s=t.substring(l,e.index);n.push((0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:x(s)}},"text-".concat(n.length)))}if(e[1].match(/([^:]+):(\d+)/)){let t=a(e[1],n.length);t?n.push(t):n.push((0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:x(e[0])}},"text-".concat(n.length)))}else n.push((0,r.jsx)(d,{abilityName:e[1],children:e[1]},"ability-".concat(n.length)));l=e.index+e[0].length}return l<t.length&&n.push((0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:x(t.substring(l))}},"text-".concat(n.length))),(0,r.jsx)("span",{className:"inline ".concat(s),children:n})}return(0,r.jsx)("span",{className:"inline ".concat(s),dangerouslySetInnerHTML:{__html:x(t)}})}function x(e){return e.replace(/\{([^}]+)\}/g,(e,t)=>{if("T"===t||"Tap"===t||"tap"===t)return'<i class="ms ms-cost ms-tap align-text-bottom"></i>';if(t.includes("/")){let[e,s]=t.split("/");return'<i class="ms ms-cost ms-'.concat(e.toLowerCase()).concat(s.toLowerCase(),' align-text-bottom"></i>')}return'<i class="ms ms-cost ms-'.concat(t.toLowerCase(),' align-text-bottom"></i>')})}function h(e){let t,s,{card:n,isEnglish:i,logoCode:o}=e,[c,d]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[u,f]=(0,a.useState)(!1),[p,g]=(0,a.useState)(!1),[b,v]=(0,a.useState)({x:0,y:0}),[j,w]=(0,a.useState)(null),[N,y]=(0,a.useState)(new Set),[_,k]=(0,a.useState)(!1),C=async e=>{if(!e.length)return[];try{let t=e.map(e=>{let[t,s]=e.split(":");return{type:"and",elements:[{type:"basic",key:"setCode",operator:"=",value:t},{type:"basic",key:"number",operator:"=",value:s}]}}),s=await fetch("https://api.sbwsz.com/search?page=1&page_size=100&get_total=1&q=".concat(encodeURIComponent(JSON.stringify({type:"or",elements:t}))));if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));return(await s.json()).results.map(e=>({setCode:e.setCode,number:e.number,zhs_name:e.zhs_name,officialName:e.officialName,translatedName:e.translatedName}))}catch(t){return console.error("Failed to fetch card names:",t),e.map(e=>{let[t,s]=e.split(":");return{setCode:t,number:s}})}};(0,a.useEffect)(()=>{n.spellbook&&n.spellbook.length>0&&C(n.spellbook).then(d)},[n.spellbook]),(0,a.useEffect)(()=>{n.related&&n.related.length>0&&C(n.related).then(h)},[n.related]),(0,a.useEffect)(()=>{if(n.related&&n.related.length>0&&x.length>0){let e=new Set;(i?n.text:n.zhs_text).split("\n").forEach(t=>{let s,r=/`([^`]+)`/g;for(;null!==(s=r.exec(t));){let t=s[1].match(/([^:]+):(\d+)/);if(t){let s=parseInt(t[2],10);x[s]&&e.add(s)}}}),y(e)}},[n.related,n.text,n.zhs_text,x,i]);let z=e=>e.split("\n").map((e,t,s)=>(0,r.jsxs)("div",{className:"inline-block w-full",children:[(0,r.jsx)(m,{text:e,renderCardRef:(e,t)=>{let s=e.match(/([^:]+):(\d+)/);if(s){let[,e,a]=s,n=x[parseInt(a,10)];if(n)return(0,r.jsx)("a",{href:L(n.setCode,n.number),target:"_blank",rel:"noopener noreferrer",className:"text-[--primary] hover:opacity-80 transition-opacity",onMouseEnter:()=>E(n),onMouseLeave:M,onMouseMove:S,children:e},t)}return null}}),t<s.length-1&&(0,r.jsx)("br",{})]},t)),L=(e,t)=>{let s=/^(\d+)[ab]$/.test(t)?t.slice(0,-1):t;return"https://sbwsz.com/card/".concat(e,"/").concat(s)},E=e=>{w(e),g(!0)},M=()=>{g(!1),w(null)},S=e=>{let t=window.innerWidth,s=window.innerHeight,r=e.clientX+20,a=e.clientY-210;r+300>t-20&&(r=e.clientX-300-20),r<20&&(r=20),a<20&&(a=20),a+420>s-20&&(a=s-420-20),v({x:r,y:a})},I=(e,t)=>{let s=e.filter((e,t)=>!N.has(t));return 0===s.length?null:(0,r.jsxs)("div",{className:"mt-4 pt-2 border-t border-[--border]",children:[(0,r.jsx)("div",{className:"text-sm font-medium mb-2",children:t}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map((e,t)=>(0,r.jsx)("a",{href:L(e.setCode,e.number),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-[--primary] hover:opacity-80 transition-opacity",onMouseEnter:()=>E(e),onMouseLeave:M,onMouseMove:S,children:e.zhs_name||e.officialName||e.translatedName||"".concat(e.setCode,":").concat(e.number)},t))})]})},F=_&&n.backface?n.backface:n;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-[--card] rounded-lg overflow-hidden border border-[--border] flex flex-col md:flex-row",children:[(0,r.jsx)("div",{className:"px-4 md:p-0 pt-4 md:pt-0",children:(0,r.jsxs)("div",{className:"relative w-full md:w-[300px] aspect-[488/680] md:h-[420px] bg-black mx-auto max-w-[300px] cursor-pointer",onClick:()=>f(!0),children:[(0,r.jsx)(l.default,{src:i?F.image_url_en:F.image_url_zh,alt:i?F.name:F.zhs_name,fill:!0,className:"object-cover",unoptimized:!0}),n.backface&&(0,r.jsx)("button",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center hover:bg-black/80 transition-colors",onClick:e=>{e.stopPropagation(),k(!_)},children:(0,r.jsxs)("svg",{className:"w-6 h-6",focusable:"false","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",children:[(0,r.jsx)("path",{fill:"currentColor",d:"M884.3,357.6c116.8,117.7,151.7,277-362.2,320V496.4L243.2,763.8L522,1031.3V860.8C828.8,839.4,1244.9,604.5,884.3,357.6z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M557.8,288.2v138.4l230.8-213.4L557.8,0v142.8c-309.2,15.6-792.1,253.6-426.5,503.8C13.6,527.9,30,330.1,557.8,288.2z"})]})})]})}),u&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>f(!1),children:(0,r.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"relative",style:{width:"min(85vw, 85vh * 488/680)",height:"min(85vh, 85vw * 680/488)"},children:(0,r.jsx)(l.default,{src:i?F.image_url_en:F.image_url_zh,alt:i?F.name:F.zhs_name,fill:!0,className:"object-contain",unoptimized:!0,sizes:"85vw"})}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[n.backface&&(0,r.jsx)("button",{className:"w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center hover:bg-black/80 transition-colors",onClick:()=>k(!_),children:(0,r.jsxs)("svg",{className:"w-6 h-6",focusable:"false","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",children:[(0,r.jsx)("path",{fill:"currentColor",d:"M884.3,357.6c116.8,117.7,151.7,277-362.2,320V496.4L243.2,763.8L522,1031.3V860.8C828.8,839.4,1244.9,604.5,884.3,357.6z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M557.8,288.2v138.4l230.8-213.4L557.8,0v142.8c-309.2,15.6-792.1,253.6-426.5,503.8C13.6,527.9,30,330.1,557.8,288.2z"})]})}),(0,r.jsx)("button",{className:"w-8 h-8 bg-black/60 text-white rounded-full flex items-center justify-center hover:bg-black/80",onClick:()=>f(!1),children:"✕"})]})]})}),(0,r.jsxs)("div",{className:"p-4 flex-1 flex flex-col min-w-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:(0,r.jsx)("div",{className:"font-medium break-words leading-none pt-0.5",children:F.zhs_name===F.name?(0,r.jsx)("h3",{children:F.name}):i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:F.name}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:F.zhs_name})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:F.zhs_name}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:F.name})]})})}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(m,{text:F.mana_cost})})]}),(0,r.jsxs)("div",{className:"mt-1 divide-y divide-[--border]",children:[(0,r.jsxs)("div",{className:"text-sm flex items-center justify-between",children:[(0,r.jsx)(m,{text:i?F.type:F.zhs_type}),(0,r.jsx)("i",{className:"ss ".concat((e=>{switch(e){case"mythic":return"ss-mythic";case"rare":return"ss-rare";case"uncommon":return"ss-uncommon";default:return"ss-common"}})(F.rarity)," ss-fw ss-3x ss-").concat(o)})]}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap pt-1 leading-normal",children:z(i?F.text:F.zhs_text)})]})]}),F.name2&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t-2 border-[--border]",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:(0,r.jsx)("div",{className:"font-medium break-words leading-none pt-0.5",children:F.zhs_name2===F.name2?(0,r.jsx)("h3",{children:F.name2}):i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:F.name2}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:F.zhs_name2})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:F.zhs_name2}),(0,r.jsx)("div",{className:"text-xs font-light text-[--muted-foreground] mt-1",children:F.name2})]})})}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(m,{text:F.mana_cost2||""})})]}),(0,r.jsxs)("div",{className:"mt-1 divide-y divide-[--border]",children:[(0,r.jsxs)("div",{className:"text-sm flex items-center justify-between",children:[(0,r.jsx)(m,{text:i?F.type2||"":F.zhs_type2||""}),(0,r.jsx)("i",{className:"ss ss-fw ss-3x ss-".concat(o," invisible")})]}),(0,r.jsx)("div",{className:"text-sm whitespace-pre-wrap pt-1 leading-normal",children:z(i?F.text2||"":F.zhs_text2||"")})]})]}),(0,r.jsxs)("div",{className:"mt-auto",children:[F.spellbook&&F.spellbook.length>0&&I(c,"法术书"),F.spellbook&&0===F.spellbook.length&&(0,r.jsxs)("div",{className:"mt-4 pt-2 border-t border-[--border]",children:[(0,r.jsx)("div",{className:"text-sm font-medium mb-2",children:"法术书"}),(0,r.jsx)("div",{className:"text-sm text-[--muted-foreground]",children:"暂未公布"})]}),F.related&&F.related.length>0&&I(x,"相关卡牌"),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1 mt-4 pt-2 border-t border-[--border]",children:[(0,r.jsxs)("div",{className:"text-xs text-[--muted-foreground] flex items-center gap-1",children:[(0,r.jsx)("i",{className:"ms ms-artist-nib ms-fw"}),(0,r.jsx)("span",{children:F.artist})]}),F.pow_tough&&(0,r.jsx)("div",{className:"text-sm font-medium",children:F.pow_tough})]})]})]})]}),p&&j&&(0,r.jsx)("div",{className:"fixed z-50 pointer-events-none",style:{left:b.x,top:b.y},children:(0,r.jsx)("div",{className:"relative bg-[--card] rounded-lg overflow-hidden shadow-xl border border-[--border]",children:(0,r.jsx)("div",{className:"w-[300px] aspect-[488/680]",children:(0,r.jsx)(l.default,{src:(t=j.setCode,s=j.number,"https://sbwsz.com/image/large/".concat(t.toUpperCase(),"/").concat(t.toUpperCase(),"_").concat(s,".jpg")),alt:j.zhs_name||j.officialName||j.translatedName||"".concat(j.setCode,":").concat(j.number),fill:!0,className:"object-contain",unoptimized:!0,onError:e=>{let t=e.target;t.src.includes("scryfall.io")||fetch("https://api.sbwsz.com/card/".concat(j.setCode,"/").concat(j.number)).then(e=>e.json()).then(e=>{var s,r;if("normal"===e.type&&(null===(r=e.data)||void 0===r?void 0:null===(s=r[0])||void 0===s?void 0:s.scryfallId)){let s=e.data[0].scryfallId;t.src="https://cards.scryfall.io/large/front/".concat(s.slice(0,1),"/").concat(s.slice(1,2),"/").concat(s,".jpg")}else t.src="/image/back.png"}).catch(()=>{t.src="/image/back.png"})}})})})})]})}var u=s(85192);function f(e){let{previewData:t,setName:s}=e,[l,i]=(0,a.useState)(!1),o=new Date>new Date(t.release_date);return(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-[1400px] mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsxs)("h1",{className:"text-2xl font-bold",children:[s,"预览",o&&(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs bg-[--primary] text-[--primary-foreground] rounded ml-2 align-middle",children:"已上线"})]})}),(0,r.jsxs)(u.$,{variant:"secondary",onClick:()=>i(!l),className:"flex items-center gap-2 whitespace-nowrap",children:[(0,r.jsx)(n.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"中/英切换"})]})]}),(0,r.jsxs)("div",{className:"bg-[--card] rounded-lg mb-8",children:[(0,r.jsx)("div",{className:"p-4",children:(0,r.jsx)("p",{className:"text-sm text-[--muted-foreground] leading-relaxed",children:t.description})}),(0,r.jsxs)("div",{className:"px-4 py-1.5 border-t border-[--border] flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-xs text-[--muted-foreground] min-w-[80px]",children:t.total_cards&&t.cards.length===t.total_cards?"共 ".concat(t.total_cards," 张卡牌"):"".concat(t.cards.length,"/").concat(t.total_cards||"?"," 张卡牌")}),(0,r.jsx)("div",{className:"flex-1 h-1 bg-[--border] rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-[--primary] transition-all duration-500",style:{width:"".concat(t.cards.length/(t.total_cards||t.cards.length)*100,"%")}})})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.cards.sort((e,s)=>{let r=t.total_cards&&t.cards.length===t.total_cards,a=parseInt(e.id.split("-")[1]),n=parseInt(s.id.split("-")[1]);return r?a-n:n-a}).map(e=>(0,r.jsx)(h,{card:e,isEnglish:l,logoCode:t.logo_code},e.id))})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[898,536,290,374,358],()=>t(28927)),_N_E=e.O()}]);
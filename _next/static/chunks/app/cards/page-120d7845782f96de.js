(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[746],{4669:(e,t,a)=>{"use strict";a.d(t,{SetIcon:()=>o});var l=a(7820),r=a(90912);let n=[],s=new Map,i=new Map;function o(e){let{set:t,className:a="",size:o="base",rarity:c,style:d}=e,u=t.startsWith("Y")?"y".concat(t.slice(t.match(/Y\d{0,2}/)[0].length)).toLowerCase():t.toLowerCase(),[m,x]=(0,r.useState)(null);if((0,r.useEffect)(()=>{if(!n.includes(u))return void x(null);if(s.has(u))return void x(s.get(u));if(i.has(u))return void i.get(u).then(e=>{x(e)});let e=fetch("https://api.scryfall.com/sets/".concat(u)).then(e=>e.json()).then(e=>{if(e.icon_svg_uri)return fetch(e.icon_svg_uri);throw Error("No SVG")}).then(e=>e.text()).then(e=>{let t=e.match(/viewBox="([^"]+)"/i),a=t?t[1]:"0 0 600 600",l=e.matchAll(/<path[^>]*\sd="([^"]+)"/gi),r=[];for(let e of l)e[1]&&r.push(e[1]);if(!(r.length>0))return s.set(u,null),null;{let e={paths:r,viewBox:a};return s.set(u,e),e}}).catch(e=>(console.error("[SetIcon] ".concat(u," 加载失败:"),e),s.set(u,null),null)).finally(()=>{i.delete(u)});i.set(u,e),e.then(e=>{x(e)})},[u]),m){let e={xs:"0.75em",sm:"0.875em",base:"1em",lg:"1.25em",xl:"1.5em","2x":"2em","3x":"3em","4x":"4em"}[o],t=1.5;if(m.viewBox){let e=m.viewBox.split(/\s+/).map(Number);4===e.length&&e[3]>0&&(t=e[2]/e[3])}let r="".concat(parseFloat(e)*t).concat(e.replace(/[\d.]+/,""));return(0,l.jsx)("svg",{ref:e=>{if(e){let t=e.previousElementSibling;t&&"svg"===t.tagName&&"true"===t.dataset.replaced&&!t.dataset.setIcon&&t.remove()}},className:"inline-block ".concat(a),style:{width:r,height:e,fill:c?({common:"#1a1818",uncommon:"#707883",rare:"#a58e4a",mythic:"#bf4427",timeshifted:"#652978"})[c]:"currentColor",...d},viewBox:m.viewBox,preserveAspectRatio:"xMidYMid meet","aria-hidden":"true","data-set-icon":"true",children:m.paths.map((e,t)=>(0,l.jsx)("path",{d:e},t))})}return(0,l.jsx)("i",{className:"keyrune ss ss-".concat(u," ").concat("base"===o?"":"ss-".concat(o)," ").concat(c?"ss-".concat(c):""," ").concat(a).trim(),style:d,"aria-hidden":"true","data-set-icon-managed":"true"})}},11923:(e,t,a)=>{"use strict";a.d(t,{$:()=>r});var l=a(7820);function r(e){let{variant:t="primary",size:a="md",className:r,...n}=e;return(0,l.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[--primary]"," ").concat({primary:"bg-[--primary] text-[--primary-foreground] hover:brightness-110 active:scale-[0.98]",secondary:"bg-[--background-subtle] text-[--foreground] hover:brightness-95 active:scale-[0.98]",ghost:"bg-transparent text-[--foreground-muted] hover:bg-[--background-subtle] hover:text-[--foreground] active:scale-[0.98]"}[t]," ").concat({sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-12 px-6 text-base",icon:"h-9 w-9 p-0"}[a]," ").concat(r),...n})}},13477:(e,t,a)=>{Promise.resolve().then(a.bind(a,79636))},15981:(e,t,a)=>{"use strict";a.d(t,{U:()=>r});var l=a(90912);function r(e){let[t,a]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let t=window.matchMedia(e);a(t.matches);let l=e=>{a(e.matches)};return t.addEventListener("change",l),()=>{t.removeEventListener("change",l)}},[e]),t}},40885:(e,t,a)=>{"use strict";a.d(t,{p:()=>r});var l=a(7820);function r(e){let{label:t,error:a,className:r,readOnly:n,...s}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[t&&(0,l.jsx)("label",{className:"text-sm font-medium text-[--component-foreground]",children:t}),(0,l.jsx)("input",{className:"\n          w-full rounded-md border border-[--border] bg-[--component-background] px-3 py-2 text-sm text-[--component-foreground]\n          placeholder:text-[--component-foreground-muted]\n          focus:border-[--primary] focus:outline-none focus:ring-1 focus:ring-[--primary]\n          disabled:cursor-not-allowed disabled:opacity-50\n          ".concat(n?"focus:ring-0 focus:border-[--border] cursor-default":"","\n          ").concat(r,"\n        "),readOnly:n,...s}),a&&(0,l.jsx)("p",{className:"text-sm text-red-500",children:a})]})}},47395:(e,t,a)=>{"use strict";a.d(t,{Id:()=>n,YV:()=>c,bf:()=>s,dY:()=>r,h6:()=>d,or:()=>l,qW:()=>o,x3:()=>i});let l=[{label:"真人轮抽",value:"PremierDraft"},{label:"选两张轮抽",value:"PickTwoDraft"},{label:"快速轮抽",value:"QuickDraft"},{label:"现开赛",value:"Sealed"},{label:"真人轮抽BO3",value:"TradDraft"},{label:"选两张轮抽BO3",value:"PickTwoTradDraft"},{label:"现开赛BO3",value:"TradSealed"},{label:"神器混合真人轮抽",value:"PremierDraftRemixArtifacts"},{label:"竞技场直邮赛轮抽",value:"ArenaDirect_Draft"},{label:"竞技场直邮赛现开",value:"ArenaDirect_Sealed"},{label:"机器轮抽",value:"BotDraft"},{label:"竞技轮抽",value:"CompDraft"},{label:"方盒现开",value:"CubeSealed"},{label:"十项全能决赛2022",value:"DecathlonFinals2022"},{label:"十项全能决赛2023",value:"DecathlonFinals2023"},{label:"十项全能快速轮抽",value:"DecathlonQuickDraft"},{label:"十项全能真人轮抽",value:"DecathlonTradDraft"},{label:"轮抽挑战赛",value:"DraftChallenge"},{label:"徽记快速轮抽",value:"Emblem_QuickDraft"},{label:"电竞资格赛轮抽D1",value:"EsportsQualifierDraft_D1"},{label:"电竞资格赛轮抽D2",value:"EsportsQualifierDraft_D2"},{label:"电竞轮抽",value:"Esports_Draft"},{label:"FIAB现开",value:"FIAB_Sealed"},{label:"周中快速轮抽",value:"MidWeekQuickDraft"},{label:"周中现开",value:"MidWeekSealed"},{label:"全知全能轮抽",value:"Omniscience_Draft"},{label:"公开赛第一日轮抽BO1",value:"OpenDraft_D1_Bo1"},{label:"公开赛第一日轮抽BO3",value:"OpenDraft_D1_Bo3"},{label:"公开赛第二日轮抽BO3",value:"OpenDraft_D2_Bo3"},{label:"公开赛第二日轮抽1 BO3",value:"OpenDraft_D2_Draft1_Bo3"},{label:"公开赛第二日轮抽2B BO3",value:"OpenDraft_D2_Draft2B_Bo3"},{label:"公开赛第二日轮抽2 BO3",value:"OpenDraft_D2_Draft2_Bo3"},{label:"公开赛第一日现开BO1",value:"OpenSealed_D1_Bo1"},{label:"公开赛第一日现开BO3",value:"OpenSealed_D1_Bo3"},{label:"公开赛第二日现开BO3",value:"OpenSealed_D2_Bo3"},{label:"公开赛第二日现开1 BO3",value:"OpenSealed_D2_Sealed1_Bo3"},{label:"公开赛第二日现开2 BO3",value:"OpenSealed_D2_Sealed2_Bo3"},{label:"资格赛预选现开",value:"QualifierPlayInSealed"},{label:"资格赛预选现开BO3",value:"QualifierPlayInTradSealed"},{label:"资格赛第一日现开",value:"Qualifier_D1_Sealed"},{label:"资格赛第二日轮抽",value:"Qualifier_D2_Draft"},{label:"资格赛第二日现开",value:"Qualifier_D2_Sealed"}],r=[{label:"真人轮抽",value:"PremierDraft"},{label:"选两张轮抽",value:"PickTwoDraft"},{label:"快速轮抽",value:"QuickDraft"},{label:"现开赛",value:"Sealed"},{label:"真人轮抽BO3",value:"TradDraft"},{label:"现开赛BO3",value:"TradSealed"},{label:"神器混合真人轮抽",value:"PremierDraftRemixArtifacts"},{label:"公开赛第二日现开BO3",value:"OpenSealed_D2_Bo3"},{label:"公开赛第二日轮抽BO3",value:"OpenDraft_D2_Bo3"},{label:"公开赛第一日轮抽BO1",value:"OpenDraft_D1_Bo1"},{label:"公开赛第二日轮抽BO3",value:"OpenDraft_D2_Draft1_Bo3"},{label:"全知轮抽",value:"Omniscience_Draft"},{label:"中周现开",value:"MidWeekSealed"},{label:"中周轮抽",value:"MidWeekQuickDraft"},{label:"轮抽挑战赛",value:"DraftChallenge"},{label:"十项全能真人轮抽",value:"DecathlonTradDraft"},{label:"十项全能快速轮抽",value:"DecathlonQuickDraft"},{label:"十项全能决赛2022",value:"DecathlonFinals2022"},{label:"混沌轮抽",value:"CubeDraft"},{label:"资格赛预选现开",value:"QualifierPlayInSealed"},{label:"资格赛预选现开BO3",value:"QualifierPlayInTradSealed"},{label:"资格赛第一日现开",value:"Qualifier_D1_Sealed"},{label:"公开赛第一日现开BO3",value:"OpenSealed_D1_Bo3"},{label:"公开赛第一日现开BO1",value:"OpenSealed_D1_Bo1"},{label:"竞技场直邮赛现开",value:"ArenaDirect_Sealed"}],n=[{label:"ECL",value:"ECL"},{label:"Y26ECL",value:"Y26ECL"},{label:"TLA",value:"TLA"},{label:"OM1",value:"OM1"},{label:"EOE",value:"EOE"},{label:"Y25EOE",value:"Y25EOE"},{label:"FIN",value:"FIN"},{label:"TDM",value:"TDM"},{label:"Y25TDM",value:"Y25TDM"},{label:"DFT",value:"DFT"},{label:"Y25DFT",value:"Y25DFT"},{label:"PIO",value:"PIO"},{label:"FDN",value:"FDN"},{label:"DSK",value:"DSK"},{label:"Y25DSK",value:"Y25DSK"},{label:"BLB",value:"BLB"},{label:"Y25BLB",value:"Y25BLB"},{label:"MH3",value:"MH3"},{label:"OTJ",value:"OTJ"},{label:"Y24OTJ",value:"Y24OTJ"},{label:"MKM",value:"MKM"},{label:"Y24MKM",value:"Y24MKM"},{label:"LCI",value:"LCI"},{label:"Y24LCI",value:"Y24LCI"},{label:"WOE",value:"WOE"},{label:"Y24WOE",value:"Y24WOE"},{label:"LTR",value:"LTR"},{label:"MOM",value:"MOM"},{label:"MAT",value:"MAT"},{label:"SIR",value:"SIR"},{label:"ONE",value:"ONE"},{label:"Y23ONE",value:"Y23ONE"},{label:"BRO",value:"BRO"},{label:"Y23BRO",value:"Y23BRO"},{label:"DMU",value:"DMU"},{label:"Y23DMU",value:"Y23DMU"},{label:"HBG",value:"HBG"},{label:"SNC",value:"SNC"},{label:"Y22SNC",value:"Y22SNC"},{label:"NEO",value:"NEO"},{label:"DBL",value:"DBL"},{label:"VOW",value:"VOW"},{label:"RAVM",value:"RAVM"},{label:"MID",value:"MID"},{label:"AFR",value:"AFR"},{label:"STX",value:"STX"},{label:"CORE",value:"CORE"},{label:"KHM",value:"KHM"},{label:"KLR",value:"KLR"},{label:"ZNR",value:"ZNR"},{label:"AKR",value:"AKR"},{label:"M21",value:"M21"},{label:"IKO",value:"IKO"},{label:"THB",value:"THB"},{label:"ELD",value:"ELD"},{label:"Ravnica",value:"Ravnica"},{label:"M20",value:"M20"},{label:"WAR",value:"WAR"},{label:"M19",value:"M19"},{label:"DOM",value:"DOM"},{label:"RIX",value:"RIX"},{label:"GRN",value:"GRN"},{label:"RNA",value:"RNA"},{label:"KTK",value:"KTK"},{label:"XLN",value:"XLN"},{label:"Cube - Powered",value:"Cube - Powered"},{label:"Cube",value:"Cube"},{label:"Chaos",value:"Chaos"}],s=[{label:"所有用户",value:""},{label:"低级",value:"bottom"},{label:"中级",value:"middle"},{label:"顶级",value:"top"}],i=[{label:"全部套牌",value:""},{label:"W",value:"W"},{label:"U",value:"U"},{label:"B",value:"B"},{label:"R",value:"R"},{label:"G",value:"G"},{label:"WU",value:"WU"},{label:"WB",value:"WB"},{label:"WR",value:"WR"},{label:"WG",value:"WG"},{label:"UB",value:"UB"},{label:"UR",value:"UR"},{label:"UG",value:"UG"},{label:"BR",value:"BR"},{label:"BG",value:"BG"},{label:"RG",value:"RG"},{label:"WUB",value:"WUB"},{label:"WUR",value:"WUR"},{label:"WUG",value:"WUG"},{label:"WBR",value:"WBR"},{label:"WBG",value:"WBG"},{label:"WRG",value:"WRG"},{label:"UBR",value:"UBR"},{label:"UBG",value:"UBG"},{label:"URG",value:"URG"},{label:"BRG",value:"BRG"},{label:"WUBR",value:"WUBR"},{label:"WUBG",value:"WUBG"},{label:"WURG",value:"WURG"},{label:"WBRG",value:"WBRG"},{label:"UBRG",value:"UBRG"},{label:"WUBRG",value:"WUBRG"}],o=[{label:"W",value:"W"},{label:"U",value:"U"},{label:"B",value:"B"},{label:"R",value:"R"},{label:"G",value:"G"},{label:"M",value:"M"},{label:"C",value:"C"}],c=[{label:"普通",value:"common"},{label:"非普通",value:"uncommon"},{label:"稀有",value:"rare"},{label:"秘稀",value:"mythic"}],d=Object.fromEntries(l.map(e=>[e.value,e.label]))},79339:(e,t,a)=>{"use strict";a.d(t,{l:()=>r});var l=a(7820);function r(e){let{label:t,error:a,options:r=[],groups:n,className:s,...i}=e,o=n&&n.length>0;return(0,l.jsxs)("div",{className:"space-y-2",children:[t&&(0,l.jsx)("label",{className:"text-sm font-medium text-[--component-foreground]",children:t}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("select",{className:"\n            w-full rounded-md border border-[--border] bg-[--component-background] px-3 pr-10 py-2 text-sm text-[--component-foreground]\n            appearance-none\n            focus:border-[--primary] focus:outline-none focus:ring-1 focus:ring-[--primary]\n            disabled:cursor-not-allowed disabled:opacity-50\n            ".concat(s,"\n          "),...i,children:o?n.map(e=>(0,l.jsx)("optgroup",{label:e.label,children:e.options.map(e=>(0,l.jsx)("option",{value:e.value,className:"bg-[--component-background]",disabled:e.disabled,children:e.label},e.value))},e.label)):r.map(e=>(0,l.jsx)("option",{value:e.value,className:"bg-[--component-background]",disabled:e.disabled,children:e.label},e.value))}),(0,l.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2",children:(0,l.jsx)("svg",{className:"h-4 w-4 fill-current text-[--component-foreground-muted]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),a&&(0,l.jsx)("p",{className:"text-sm text-red-500",children:a})]})}},79636:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eC});var l=a(7820),r=a(90912);function n(e){let{className:t,size:a="md",text:r}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 space-y-4 ".concat(t||""),children:[(0,l.jsx)("div",{className:"animate-spin rounded-full border-[--muted] border-t-[--primary] ".concat({sm:"w-4 h-4 border-2",md:"w-8 h-8 border-4",lg:"w-12 h-12 border-4"}[a])}),r&&(0,l.jsx)("p",{className:"text-sm text-[--muted-foreground] animate-pulse",children:r})]})}function s(e){let{data:t,columns:a,isLoading:n,emptyText:s="暂无数据",sortColumn:i,sortDirection:o,onSort:c,expansion:d=""}=e,u=(0,r.useRef)(null),m=(0,r.useRef)(null),[x,h]=(0,r.useState)(null),[v,f]=(0,r.useState)(null),g=(0,r.useCallback)(e=>{u.current=e,h(e)},[]),p=(0,r.useCallback)(e=>{m.current=e,f(e)},[]),b=(0,r.useCallback)(()=>{var e;if(!m.current)return;let t=m.current.querySelectorAll("td");if(!t.length)return;let l=Array.from(t).slice(0,a.length).map(e=>e.getBoundingClientRect().width);if(!l.some((e,t)=>{var a,l;return Math.abs(((null==(l=u.current)||null==(a=l.querySelectorAll("th")[t])?void 0:a.getBoundingClientRect().width)||0)-e)>.1}))return;let r=null==(e=u.current)?void 0:e.querySelectorAll("th");r&&r.forEach((e,t)=>{e.style.width="".concat(l[t],"px"),e.style.maxWidth="".concat(l[t],"px"),e.style.minWidth="".concat(l[t],"px")})},[a.length]),w=(0,r.useCallback)((e,t)=>a=>{let l=a.target;l===e?requestAnimationFrame(()=>{t.scrollLeft=l.scrollLeft}):requestAnimationFrame(()=>{e.scrollLeft=l.scrollLeft})},[]),j=(0,r.useMemo)(()=>(0,l.jsx)("tr",{children:a.map(e=>(0,l.jsx)("th",{className:"\n            px-4 py-3 text-left text-sm font-medium text-[--table-header-foreground] whitespace-nowrap\n            ".concat(e.sortable?"cursor-pointer hover:text-[--primary]":"","\n          "),title:e.title,onClick:()=>e.sortable&&(null==c?void 0:c(e.accessorKey)),children:(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[e.header,e.sortable&&i===e.accessorKey&&(0,l.jsx)("span",{className:"text-[--primary]",children:"asc"===o?"↑":"↓"})]})},String(e.accessorKey)))}),[a,i,o,c]);return((0,r.useEffect)(()=>{if(!x||!v)return;let e=w(x,v);return x.addEventListener("scroll",e),v.addEventListener("scroll",e),()=>{x.removeEventListener("scroll",e),v.removeEventListener("scroll",e)}},[w,x,v]),(0,r.useEffect)(()=>{var e;b(),window.addEventListener("resize",b);let t=new ResizeObserver(b),l=null==(e=m.current)?void 0:e.querySelectorAll("td");return l&&Array.from(l).slice(0,a.length).forEach(e=>{t.observe(e)}),()=>{window.removeEventListener("resize",b),t.disconnect()}},[t,b,a.length]),n)?(0,l.jsx)("div",{className:"w-full h-96 flex items-center justify-center text-[--muted-foreground]",children:"加载中..."}):t.length?(0,l.jsxs)("div",{className:"w-full relative",children:[(0,l.jsx)("div",{ref:g,className:"w-full overflow-x-auto border-b border-[--table-border] bg-[--background]",style:{position:"sticky",top:"64px",zIndex:1},children:(0,l.jsx)("table",{className:"min-w-full w-max border-collapse",children:(0,l.jsx)("thead",{children:j})})}),(0,l.jsx)("div",{ref:p,className:"w-full overflow-x-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden",children:(0,l.jsx)("table",{className:"min-w-full w-max border-collapse",children:(0,l.jsx)("tbody",{children:t.map((e,r)=>(0,l.jsx)("tr",{className:"border-b border-[--table-border] hover:bg-[--table-row-hover]",children:a.map(a=>(0,l.jsx)("td",{className:"px-4 py-3 text-sm text-[--foreground] whitespace-nowrap",children:a.cell?a.cell(e[a.accessorKey],e,t,d):String(e[a.accessorKey])},String(a.accessorKey)))},r))})})})]}):(0,l.jsx)("div",{className:"w-full h-96 flex items-center justify-center text-[--muted-foreground]",children:s})}var i=a(11923),o=a(34115),c=a(56879);let d=[{header:"# Seen",title:"轮抽中见过的次数",description:'这张卡在轮抽包中被看到的次数。如果一张卡传回来又被看到（"轮回"），只计算一次。注意：由于Arena限制，P1P1有时只记录选择的牌，该牌也会被计入"见过"的统计。'},{header:"ALSA",title:"平均最后见到的抓位",description:"Average Last Seen At - 这张卡在轮抽包中最后一次被看到时的平均顺位。如果卡片轮回，只有第二次看到时的顺位才会计入平均值。数值越小说明这张卡越受欢迎，因为它更早被选走而不会轮回。"},{header:"# Picked",title:"被选择的次数",description:"17Lands用户在轮抽中选择这张卡的总次数。"},{header:"ATA",title:"平均选择抓位",description:"Average Taken At - 17Lands用户选择这张卡时的平均顺位。数值越小说明这张卡的优先级越高，通常意味着更强力。"},{header:"# GP",title:"使用过的对局数量",description:"Games Played - 这张卡在主牌中被使用的对局数量，按副数加权。例如：主牌带3张该卡打8局，权重为24（3\xd78）。"},{header:"% GP",title:"主牌使用率",description:"Play Rate - 当卡池中有这张卡时，将其放入主牌的比率，按对局数和副数加权。高使用率说明这张卡更可能进入主牌而不是备牌。注意：Bo3赛制中，备牌局数也会影响此数据。"},{header:"GP WR",title:"主牌使用时的胜率",description:"Games Played Win Rate - 主牌中至少有一张该卡的套牌胜率，按副数加权。主牌带10张该卡的权重是带1张的10倍。"},{header:"# OH",title:"在起手的对局数量",description:'Opening Hand - 这张卡在起手手牌中出现的次数，每张单独计数。"起手"是指调度后决定保留的全部手牌（包括调度时置底的牌，以及如Leyline类在游戏开始时就进战场的牌）。'},{header:"OH WR",title:"在起手时的胜率",description:"Opening Hand Win Rate - 起手有这张卡时的胜率，按副数加权。注意：昂贵或难施放的牌可能因更容易导致调度而有偏差。"},{header:"# GD",title:"抽到的对局数量",description:'Game Drawn - 从牌库抽到这张卡的次数（不包括起手）。包括回合抽牌和抽牌效应，但不包括从战场/坟场返回手牌、检索、或从放逐区使用的牌。"检索"指任何从牌库中选择牌的效应（包括进化荒野等）。'},{header:"GD WR",title:"抽到时的胜率",description:"Game Drawn Win Rate - 从牌库抽到这张卡时的胜率（不包括起手），按副数加权。"},{header:"# GIH",title:"在手上的对局数量",description:"Game In Hand - 这张卡进入手牌的总次数（起手+抽到），每张单独计数。极少数情况下，同一张牌可能被多次抽到（如被洗回牌库）。"},{header:"GIH WR",title:"在手上时的胜率",description:"Game In Hand Win Rate - 这张卡进入手牌时的胜率（起手+抽到），按副数加权。这是评估卡牌强度最重要的指标之一，因为它反映了实际拿到牌时对胜率的影响。"},{header:"# GNS",title:"未见到的数量",description:'Game Not Seen - 主牌中的副数减去被抽到或检索到（"见到"）的副数。如果见到的副数超过主牌副数，此值为0。按未见到的副数加权。'},{header:"GNS WR",title:"未见到时的胜率",description:"Game Not Seen Win Rate - 主牌中有这张卡但整局都未见到时的胜率，按未见到的副数加权。"},{header:"IIH",title:"在手时的胜率提升",description:"Improvement In Hand - GIH WR与GNS WR的差值，表示拿到这张卡相比未拿到时的胜率提升。正值越大说明这张卡对胜利的贡献越大。注意：此指标是简单差值，未按对局数加权，可能高估强力后期牌的价值。"}];function u(){let[e,t]=(0,r.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>t(!0),title:"查看指标说明",className:"h-8 w-8 text-[--foreground-muted] hover:text-[--foreground]",children:(0,l.jsx)(o.A,{className:"h-4 w-4"})}),e&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:()=>t(!1)}),(0,l.jsxs)("div",{className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[calc(100%-2rem)] sm:w-full max-w-2xl max-h-[85vh] sm:max-h-[80vh] bg-[--component-background] rounded-lg shadow-xl z-50 overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[--border]",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-[--foreground]",children:"指标说明"}),(0,l.jsx)("button",{onClick:()=>t(!1),className:"text-[--foreground-muted] hover:text-[--foreground] transition-colors",children:(0,l.jsx)(c.A,{className:"h-5 w-5"})})]}),(0,l.jsx)("div",{className:"overflow-y-auto p-4 sm:p-6 flex-1",children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base font-bold text-[--foreground] mb-3 pb-2 border-b border-[--border]",children:"轮抽数据 (In-Draft Statistics)"}),(0,l.jsx)("div",{className:"space-y-3",children:d.slice(0,4).map((e,t)=>(0,l.jsxs)("div",{className:"p-3 rounded-md bg-[--background-subtle]",children:[(0,l.jsxs)("div",{className:"flex items-baseline gap-2 mb-1.5",children:[(0,l.jsx)("span",{className:"font-semibold text-[--foreground] text-sm whitespace-nowrap",children:e.header}),(0,l.jsx)("span",{className:"text-xs text-[--foreground-muted]",children:e.title})]}),e.description&&(0,l.jsx)("p",{className:"text-sm text-[--foreground-muted] leading-relaxed",children:e.description})]},t))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base font-bold text-[--foreground] mb-3 pb-2 border-b border-[--border]",children:"对局数据 (In-Game Statistics)"}),(0,l.jsx)("div",{className:"space-y-3",children:d.slice(4).map((e,t)=>(0,l.jsxs)("div",{className:"p-3 rounded-md bg-[--background-subtle]",children:[(0,l.jsxs)("div",{className:"flex items-baseline gap-2 mb-1.5",children:[(0,l.jsx)("span",{className:"font-semibold text-[--foreground] text-sm whitespace-nowrap",children:e.header}),(0,l.jsx)("span",{className:"text-xs text-[--foreground-muted]",children:e.title})]}),e.description&&(0,l.jsx)("p",{className:"text-sm text-[--foreground-muted] leading-relaxed",children:e.description})]},t))})]})]})}),(0,l.jsx)("div",{className:"px-4 py-3 border-t border-[--border] flex justify-end",children:(0,l.jsx)(i.$,{variant:"secondary",size:"sm",onClick:()=>t(!1),children:"我知道了"})})]})]})]})}function m(e){let{columns:t,visibleColumns:a,onColumnToggle:n}=e,[s,o]=(0,r.useState)(!1),c=(0,r.useMemo)(()=>{let e=["name","color","rarity"];return t.filter(t=>!e.includes(t.accessorKey))},[t]),d=(0,r.useMemo)(()=>c.filter(e=>a.has(String(e.accessorKey))).length,[c,a]);return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"sm:hidden mb-2 flex items-center gap-2",children:[(0,l.jsxs)(i.$,{variant:"secondary",size:"sm",onClick:()=>o(!s),className:"flex-1 flex items-center justify-between bg-[--component-background]",children:[(0,l.jsx)("span",{children:"显示/隐藏列"}),(0,l.jsxs)("span",{className:"text-xs text-[--foreground-muted]",children:[d,"/",c.length]})]}),(0,l.jsx)(u,{})]}),(0,l.jsxs)("div",{className:"hidden sm:flex sm:items-center sm:gap-3",children:[(0,l.jsxs)("span",{className:"text-sm text-[--component-foreground-muted] flex items-center gap-1",children:["显示/隐藏列：",(0,l.jsx)(u,{})]}),(0,l.jsx)("div",{className:"flex-1 min-w-[240px] overflow-x-auto",children:(0,l.jsx)("div",{className:"flex items-center gap-2 whitespace-nowrap pb-1",children:c.map(e=>{let t=String(e.accessorKey),r=a.has(t);return(0,l.jsx)(i.$,{variant:r?"secondary":"ghost",size:"sm",onClick:()=>n(t),title:e.title,className:"inline-flex justify-center text-sm rounded-full px-4 border transition-all ".concat(r?"bg-gradient-to-r from-[--accent]/20 to-[--accent]/10 text-[--foreground] border-[--accent]/60 font-medium shadow-sm hover:border-[--accent]":"bg-[--component-background] text-[--foreground-muted] border-[--border] hover:text-[--foreground] hover:border-[--accent]/50"),children:e.header},t)})})})]}),(0,l.jsx)("div",{className:"sm:hidden ".concat(s?"":"hidden"),children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:c.map(e=>{let t=String(e.accessorKey),r=a.has(t);return(0,l.jsx)(i.$,{variant:r?"secondary":"ghost",size:"sm",onClick:()=>n(t),title:e.title,className:"w-full justify-start text-sm rounded-full border transition-all ".concat(r?"bg-gradient-to-r from-[--accent]/20 to-[--accent]/10 text-[--foreground] border-[--accent]/60 font-medium shadow-sm hover:border-[--accent]":"bg-[--component-background] text-[--foreground-muted] border-[--border] hover:text-[--foreground] hover:border-[--accent]/50"),children:e.header},t)})})})]})}var x=a(49979);function h(e){let{color:t}=e,a=""===t?["C"]:t.split("").sort(),r=5===a.length?"-space-x-2":a.length>=3?"-space-x-1":"gap-0.5";return(0,l.jsx)("div",{className:"flex ".concat(r),children:a.map((e,t)=>(0,l.jsx)("div",{className:"w-4 h-4 bg-no-repeat bg-center bg-contain card-symbol-".concat(e),title:function(e){switch(e){case"W":return"白色";case"U":return"蓝色";case"B":return"黑色";case"R":return"红色";case"G":return"绿色";case"M":return"多色";case"C":return"无色";default:return""}}(e)},t))})}var v=a(75334);let f="cards.scryfall.io",g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";return"https://".concat(f,"/").concat(t,"/front/").concat(e.slice(0,1),"/").concat(e.slice(1,2),"/").concat(e,".jpg")},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";if(!e)return null;try{let a=new URL(e);if(a.hostname!==f)return null;let l=a.pathname.split("/");if(l.length>=3)return l[1]=t,a.pathname=l.join("/"),a.toString()}catch(e){console.error("Failed to replace Scryfall image variant",e)}return null},b=(e,t)=>{let a=p(e,"art_crop");return a||(t?g(t,"art_crop"):null!=e?e:null)},w=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"large";return e||(t?g(t,a):null)},j=null;class _{get(e){if(!this.cache.has(e))return;let t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){let e=this.cache.keys().next().value;void 0!==e&&this.cache.delete(e)}this.cache.set(e,t)}has(e){return this.cache.has(e)}clear(){this.cache.clear()}size(){return this.cache.size}constructor(e){this.cache=new Map,this.maxSize=e}}let N=new _(100);async function y(e,t){let a=new URLSearchParams({expansion:e.expansion,event_type:e.event_type,start_date:e.start_date,end_date:e.end_date});e.user_group&&a.append("user_group",e.user_group),e.colors&&a.append("colors",e.colors);let l=await fetch("https://www.17lands.com/card_ratings/data?".concat(a),{headers:{accept:"application/json"},signal:t});if(!l.ok)throw Error("Failed to fetch card data");return l.json()}function k(e){try{let t=e.match(/\/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})\./i);return t?t[1]:null}catch(t){return console.error("Failed to extract Scryfall ID from URL:",e,t),null}}async function S(){if(j)return j;try{let e=await fetch("https://mtgch.com/static/card_names.json");if(!e.ok)throw Error("Failed to fetch card names");let t=await e.json(),a=new Map;for(let[e,l]of t)e&&l&&a.set(e,l);return j=a,a}catch(e){return console.error("Failed to load static Chinese names:",e),new Map}}async function C(e){let t=N.get(e);if(t)return t;try{let t=await fetch("https://mtgch.com/api/v1/result?q=id%3D".concat(e,"&page=1&page_size=1&unique=oracle_id&priority_chinese=true&view=1"),{headers:{accept:"application/json"}});if(!t.ok)throw Error("Failed to fetch card detail");let a=await t.json();if(a.items&&a.items.length>0){let t=a.items[0];return N.set(e,t),t}return null}catch(t){return console.error("Failed to fetch card detail by Scryfall ID:",e,t),null}}async function D(e,t,a){try{let e=await S(),l=t.map(t=>{var a;let l=t.name.replace(/\s*\/\/\s*/g,"/"),r=e.get(l)||e.get(t.name)||t.name;r=(a=r).includes(" // ")?a:a.replace(/\//g," // ");let n="";return t.url&&(n=k(t.url)||""),{name:t.name,zhs_name:r,atomic_official_name:r,atomic_translated_name:r,id:n}});return a&&l.length>0&&a(l),l}catch(e){return console.error("Failed to fetch all Chinese card data:",e),[]}}var R=a(4669);let M=(0,r.memo)(e=>{var t,a,n,s,i,o,c,d,u,m;let{card:f,visible:g,x:p,y:b,expansion:j,isMobile:_,onClose:N,onMouseEnter:y,onMouseLeave:S}=e,{chineseCards:D}=(0,x.xp)(),M=D[f.name],B=(null==M?void 0:M.atomic_official_name)||(null==M?void 0:M.atomic_translated_name)||(null==M?void 0:M.zhs_name),[L,O]=(0,r.useState)(null),F=(0,r.useRef)(null),W=(0,r.useRef)(!1),E=(0,r.useRef)(null),[A,z]=(0,r.useState)(null),G=e=>e?e.replace(/\\n/g,"\n").replace(/CARDNAME/g,B||f.name):"";g&&!W.current?(F.current={x:p,y:b},W.current=!0):!g&&W.current&&(F.current=null,W.current=!1);let I=(0,r.useCallback)(e=>{var t,a,l,r;if(!g)return{top:0,left:0,width:650};let n=null!=(l=null==(t=F.current)?void 0:t.x)?l:0,s=null!=(r=null==(a=F.current)?void 0:a.y)?r:0;if(_)return{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"calc(100% - 32px)",maxWidth:"450px",maxHeight:"calc(100vh - 64px)",overflow:"auto"};let i=window.innerHeight,o=window.innerWidth,c=Math.min(650,o-40),d=e||400,u=s+10;u+d+10>i&&(u=s-d-10),u<10&&(u=10),u+d+10>i&&(u=i-d-10);let m=n+10;return m+c+10>o&&(m=n-c-10),m<10&&(m=10),m+c>o-10&&(m=o-c-10),{top:u,left:m,width:c}},[g,_]);if((0,r.useEffect)(()=>{g?z(I()):z(null)},[g,I]),(0,r.useEffect)(()=>{g&&L&&E.current&&!_&&requestAnimationFrame(()=>{E.current&&z(I(E.current.offsetHeight))})},[L,g,_,I]),(0,r.useEffect)(()=>{if(!g)return void O(null);if(g&&f.url){let e=k(f.url);e&&C(e).then(e=>{if(!e)return;let t=e=>e?e.replace(/<p>/g,"").replace(/<\/p>/g,"\n").replace(/<br\s*\/?>/g,"\n").replace(/<[^>]+>/g,"").trim():"",a={zhs_type:e.display_type_line||"",zhs_text:t(e.oracle_text_html),zhs_name:e.display_name_zh||e.display_name};O({type:e.other_faces&&e.other_faces.length>0?"double":"normal",data:e.other_faces&&e.other_faces.length>0?[a,{zhs_type:e.other_faces[0].display_type_line||"",zhs_text:t(e.other_faces[0].oracle_text_html),zhs_name:e.other_faces[0].display_name_zh||e.other_faces[0].display_name}]:[a]})}).catch(console.error)}},[g,f.url]),!g||!A)return null;let T=j.startsWith("Y")?"y".concat(j.slice(j.match(/Y\d{0,2}/)[0].length)).toLowerCase():j.toLowerCase(),U=w(f.url,null==M?void 0:M.id,"normal");return(0,l.jsxs)(l.Fragment,{children:[_&&g&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>{null==N||N();let e=new MouseEvent("mouseleave");document.dispatchEvent(e)}}),(0,l.jsxs)("div",{ref:E,className:"fixed z-50 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 ".concat(_?"overflow-y-auto aspect-[3/4]":"p-4"),style:{...A,..._?{}:{minWidth:"400px",maxWidth:"650px"}},onClick:e=>e.stopPropagation(),onMouseEnter:y,onMouseLeave:S,children:[_&&(0,l.jsx)("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-800 p-4 border-b border-gray-200 dark:border-gray-700",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"font-bold text-lg",children:B}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:f.name})]}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation();let t=(null==M?void 0:M.id)||(f.url?k(f.url):null);t&&window.open("https://mtgch.com/result?q=id=".concat(t,"&utm_source=shiqidi"),"_blank")},className:"text-sm text-blue-500 hover:text-blue-600",children:"在 大学院废墟 中查看"})]})}),(0,l.jsx)("div",{className:_?"p-4":"",children:(0,l.jsxs)("div",{className:"flex ".concat(_?"flex-col":"gap-4"),children:[U&&_&&(0,l.jsx)("div",{className:"w-full aspect-[7/5] mb-4 rounded-lg overflow-hidden",children:(0,l.jsx)(v.default,{src:U,alt:f.name,width:350,height:250,className:"w-full h-full object-contain",unoptimized:!0})}),(0,l.jsxs)("div",{className:"space-y-3 flex-1",children:[!_&&(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-bold text-lg",children:B}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:f.name})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-20 flex justify-end",children:(0,l.jsx)(h,{color:f.color})}),(0,l.jsx)(R.SetIcon,{set:T,rarity:f.rarity.toLowerCase(),size:"2x"})]})]}),(null==L?void 0:L.data)&&(0,l.jsx)("div",{className:"text-sm p-3 bg-gray-50 dark:bg-gray-900 rounded",children:"normal"===L.type?(0,l.jsxs)("div",{className:"whitespace-pre-wrap break-words w-full",children:[(0,l.jsx)("div",{className:"font-medium mb-1",children:null==(t=L.data[0])?void 0:t.zhs_type}),(0,l.jsx)("div",{children:G(null==(a=L.data[0])?void 0:a.zhs_text)})]}):(0,l.jsxs)("div",{className:"flex gap-4 w-full",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0 whitespace-pre-wrap break-words",children:[(0,l.jsx)("div",{className:"font-medium mb-1",children:null==(n=L.data[0])?void 0:n.zhs_name}),(0,l.jsx)("div",{className:"font-medium text-sm text-gray-600 dark:text-gray-400 mb-1",children:null==(s=L.data[0])?void 0:s.zhs_type}),(0,l.jsx)("div",{children:G(null==(i=L.data[0])?void 0:i.zhs_text)})]}),(0,l.jsx)("div",{className:"w-px bg-gray-200 dark:bg-gray-700 mx-2 shrink-0"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 whitespace-pre-wrap break-words",children:[(0,l.jsx)("div",{className:"font-medium mb-1",children:null==(o=L.data[1])?void 0:o.zhs_name}),(0,l.jsx)("div",{className:"font-medium text-sm text-gray-600 dark:text-gray-400 mb-1",children:null==(c=L.data[1])?void 0:c.zhs_type}),(0,l.jsx)("div",{children:G(null==(d=L.data[1])?void 0:d.zhs_text)})]})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-sm bg-gray-50 dark:bg-gray-900 p-2 rounded",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"font-medium text-lg",children:(null==(u=f.avg_seen)?void 0:u.toFixed(1))||"-"}),(0,l.jsx)("div",{className:"text-gray-500",children:"平均抓位"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"font-medium text-lg",children:(f.ever_drawn_win_rate?(100*f.ever_drawn_win_rate).toFixed(1):"-")+"%"}),(0,l.jsx)("div",{className:"text-gray-500",children:"在手胜率"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"font-medium text-lg",children:(f.drawn_improvement_win_rate?(100*f.drawn_improvement_win_rate).toFixed(1):"-")+"%"}),(0,l.jsx)("div",{className:"text-gray-500",children:"在手胜率提升"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"见过次数"}),(0,l.jsx)("span",{className:"font-medium",children:f.seen_count||0})]}),(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"选择次数"}),(0,l.jsx)("span",{className:"font-medium",children:f.pick_count||0})]}),(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"平均选择位置"}),(0,l.jsx)("span",{className:"font-medium",children:(null==(m=f.avg_pick)?void 0:m.toFixed(1))||"-"})]}),(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"游戏次数"}),(0,l.jsx)("span",{className:"font-medium",children:f.game_count||0})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm border-t pt-2",children:[(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"起手胜率"}),(0,l.jsx)("span",{className:"font-medium",children:(f.opening_hand_win_rate?(100*f.opening_hand_win_rate).toFixed(1):"-")+"%"})]}),(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"抽到胜率"}),(0,l.jsx)("span",{className:"font-medium",children:(f.drawn_win_rate?(100*f.drawn_win_rate).toFixed(1):"-")+"%"})]}),(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"未抽到胜率"}),(0,l.jsx)("span",{className:"font-medium",children:(f.never_drawn_win_rate?(100*f.never_drawn_win_rate).toFixed(1):"-")+"%"})]}),(0,l.jsxs)("p",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"使用胜率"}),(0,l.jsx)("span",{className:"font-medium",children:(f.win_rate?(100*f.win_rate).toFixed(1):"-")+"%"})]})]})]}),U&&!_&&(0,l.jsx)("div",{className:"w-[240px] h-[340px] flex-shrink-0 rounded-lg overflow-hidden",children:(0,l.jsx)(v.default,{src:U,alt:f.name,width:240,height:340,className:"object-cover",unoptimized:!0})})]})})]})]})},(e,t)=>e.visible===t.visible&&e.card.name===t.card.name&&e.expansion===t.expansion&&e.isMobile===t.isMobile);var B=a(15981);function L(e){let{card:t,expansion:a,quantity:n}=e,{chineseCards:s}=(0,x.xp)(),i=s[t.name],o=(null==i?void 0:i.atomic_official_name)||(null==i?void 0:i.atomic_translated_name)||(null==i?void 0:i.zhs_name),c=(0,B.U)("(max-width: 1024px)"),[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)({x:0,y:0}),v=(0,r.useRef)(null),f=(0,r.useRef)(null),g=b(t.url,null==i?void 0:i.id);return(0,r.useEffect)(()=>(c&&d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset",v.current&&clearTimeout(v.current),f.current&&clearTimeout(f.current)}),[c,d]),(0,l.jsxs)("div",{className:"relative max-w-[300px] cursor-pointer",style:{backgroundImage:g?"url(".concat(g,")"):"none",backgroundSize:"cover",backgroundPosition:"50% 20%"},onMouseEnter:()=>{!c&&(v.current&&(clearTimeout(v.current),v.current=null),d||(f.current=setTimeout(()=>{u(!0),f.current=null},300)))},onMouseLeave:()=>{!c&&(f.current&&(clearTimeout(f.current),f.current=null),d&&(v.current=setTimeout(()=>{u(!1)},200)))},onMouseMove:e=>{c||h({x:e.clientX,y:e.clientY})},onClick:e=>{if(c){e.preventDefault(),e.stopPropagation();let t=e.currentTarget.getBoundingClientRect();h({x:t.left,y:t.top+window.scrollY}),u(!d)}else{let e=(null==i?void 0:i.id)||(t.url?k(t.url):null);e&&window.open("https://mtgch.com/result?q=id=".concat(e,"&utm_source=shiqidi"),"_blank")}},children:[(0,l.jsxs)("div",{className:"relative z-1 bg-black/50 p-1 rounded hover:bg-black/60 transition-colors",children:[(0,l.jsxs)("div",{className:"font-medium text-white truncate flex items-center gap-1",children:[(0,l.jsx)("span",{children:o||t.name}),n&&n>1&&(0,l.jsxs)("span",{className:"text-[10px] bg-yellow-500/80 text-black px-1 rounded-sm font-bold",children:["x",n]})]}),(0,l.jsx)("div",{className:"text-sm text-gray-300 truncate",children:t.name})]}),(0,l.jsx)(M,{card:t,visible:d,x:m.x,y:m.y,expansion:a,isMobile:c,onClose:()=>u(!1),onMouseEnter:()=>{!c&&v.current&&(clearTimeout(v.current),v.current=null)},onMouseLeave:()=>{c||u(!1)}})]})}function O(e){let{rank:t,total:a,value:r,zScore:n,mean:s,stdDev:i,label:o,isLowerBetter:c=!1}=e,d=["% GP","GP WR","OH WR","GD WR","GIH WR","GNS WR","IIH"].includes(o),u=e=>d?"".concat((100*e).toFixed(1),"%"):["ALSA","ATA"].includes(o)?e.toFixed(2):e.toFixed(1);return(0,l.jsx)("div",{className:"absolute z-[100] bg-[--component-background] border border-[--border] rounded-md shadow-lg p-2 text-sm min-w-[180px]",children:(0,l.jsxs)("div",{className:"space-y-0.5",children:[(0,l.jsxs)("div",{className:"font-medium text-[--component-foreground] mb-1",children:[o," 统计"]}),(0,l.jsx)("div",{className:"text-[--component-foreground-muted]",children:(0,l.jsxs)("div",{className:"grid grid-cols-[3.5rem,1fr] gap-x-1",children:[(0,l.jsx)("span",{children:"排名："}),(0,l.jsxs)("span",{className:"text-right",children:[t," / ",a]}),(0,l.jsx)("span",{children:"数值："}),(0,l.jsx)("span",{className:"text-right",children:u(r)}),(0,l.jsx)("span",{children:"Z分数："}),(0,l.jsx)("span",{className:"text-right",children:(c?-n:n).toFixed(1)}),(0,l.jsx)("span",{children:"平均值："}),(0,l.jsxs)("span",{className:"text-right",children:[u(s)," \xb1 ",u(i)]})]})})]})})}var F=a(97192),W=a(66923),E=a(93253),A=a(9034);function z(e){let{value:t,stats:a,label:n,formatter:s=e=>e.toFixed(2)}=e,[i,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)("right"),u=(0,r.useRef)(null);return((0,r.useEffect)(()=>{if(i&&u.current){let e=u.current,t=e.closest(".card");if(t){let a=e.getBoundingClientRect();d(t.getBoundingClientRect().right-a.right>=200?"right":"left")}}},[i]),null===t||null===a)?(0,l.jsx)("span",{children:"-"}):(0,l.jsxs)("div",{className:"relative inline-block",ref:u,children:[(0,l.jsxs)("span",{className:"cursor-help",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[s(t),(e=>{let t=["ALSA","ATA"].includes(n)?-e:e;return t>=2.5?(0,l.jsx)(F.A,{className:"inline-block w-3 h-3 text-green-500"}):t>=1.5?(0,l.jsx)(W.A,{className:"inline-block w-3 h-3 text-green-500"}):t<=-2.5?(0,l.jsx)(E.A,{className:"inline-block w-3 h-3 text-red-500"}):t<=-1.5?(0,l.jsx)(A.A,{className:"inline-block w-3 h-3 text-red-500"}):null})(a.zScore)]}),i&&(0,l.jsx)("div",{className:"absolute top-0 z-[9999] ".concat("right"===c?"left-full ml-2":"left-[-190px]"),children:(0,l.jsx)(O,{...a,label:n,isLowerBetter:["ALSA","ATA"].includes(n)})})]})}function G(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}function I(e,t,a){if(null===a||"number"!=typeof a||isNaN(a)||!isFinite(a))return null;let l=e.map(e=>e[t]).filter(e=>null!==e&&"number"==typeof e&&!isNaN(e)&&isFinite(e));if(0===l.length)return null;let r="avg_seen"===t||"avg_pick"===t,n=G(l),s=0===l.length?0:Math.sqrt(G(l.map(e=>Math.pow(e-n,2)))),i=0===s?0:(a-n)/s;return{rank:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return[...t].sort((e,t)=>a?e-t:t-e).indexOf(e)+1}(a,l,r),total:l.length,value:a,zScore:i,mean:n,stdDev:s}}let T={common:1,uncommon:2,rare:3,mythic:4},U=e=>""===e?0:"WUBRG"===e?7:e.length>1?6:({W:1,U:2,B:3,R:4,G:5})[e]||0;function K(e){let{data:t,isLoading:a,expansion:i,onColumnControlsChange:o,deckQuantities:c}=e,d=(0,r.useMemo)(()=>[{header:"卡牌名称",accessorKey:"name",sortable:!0,cell:(e,t)=>(0,l.jsx)(L,{card:t,expansion:i,quantity:null==c?void 0:c.get(t.name)})},{header:"颜色",accessorKey:"color",sortable:!0,cell:e=>(0,l.jsx)("div",{className:"w-12",children:(0,l.jsx)(h,{color:String(e)})})},{header:"稀有度",accessorKey:"rarity",sortable:!0,cell:(e,t,a,r)=>{let n=String(e).toLowerCase(),s=r.startsWith("Y")?"y".concat(r.slice(r.match(/Y\d{0,2}/)[0].length)).toLowerCase():r.toLowerCase();return(0,l.jsx)(R.SetIcon,{set:s,rarity:n,size:"2x"})}},{header:"# Seen",accessorKey:"seen_count",title:"轮抽中见过的次数",sortable:!0},{header:"ALSA",accessorKey:"avg_seen",title:"平均最后见到的抓位",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"avg_seen",e),label:"ALSA"})},{header:"# Picked",accessorKey:"pick_count",title:"被选择的次数",sortable:!0},{header:"ATA",accessorKey:"avg_pick",title:"平均选择抓位",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"avg_pick",e),label:"ATA"})},{header:"# GP",accessorKey:"game_count",title:"使用过的对局数量",sortable:!0},{header:"% GP",accessorKey:"play_rate",title:"主牌使用率",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"play_rate",e),label:"% GP",formatter:e=>"".concat((100*e).toFixed(1),"%")})},{header:"GP WR",accessorKey:"win_rate",title:"主牌使用时的胜率",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"win_rate",e),label:"GP WR",formatter:e=>"".concat((100*e).toFixed(1),"%")})},{header:"# OH",accessorKey:"opening_hand_game_count",title:"在起手的对局数量",sortable:!0},{header:"OH WR",accessorKey:"opening_hand_win_rate",title:"在起手时的胜率",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"opening_hand_win_rate",e),label:"OH WR",formatter:e=>"".concat((100*e).toFixed(1),"%")})},{header:"# GD",accessorKey:"drawn_game_count",title:"第一回合后抽到的对局数量",sortable:!0},{header:"GD WR",accessorKey:"drawn_win_rate",title:"第一回合后抽到的胜率",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"drawn_win_rate",e),label:"GD WR",formatter:e=>"".concat((100*e).toFixed(1),"%")})},{header:"# GIH",accessorKey:"ever_drawn_game_count",title:"在手上的对局数量(起手或抽到)",sortable:!0},{header:"GIH WR",accessorKey:"ever_drawn_win_rate",title:"在手上时的胜率(起手或抽到)",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"ever_drawn_win_rate",e),label:"GIH WR",formatter:e=>"".concat((100*e).toFixed(1),"%")})},{header:"# GNS",accessorKey:"never_drawn_game_count",title:"未见到的对局数量",sortable:!0},{header:"GNS WR",accessorKey:"never_drawn_win_rate",title:"未见到的胜率",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"never_drawn_win_rate",e),label:"GNS WR",formatter:e=>"".concat((100*e).toFixed(1),"%")})},{header:"IIH",accessorKey:"drawn_improvement_win_rate",title:"在手时的胜率提升",sortable:!0,cell:(e,t,a)=>(0,l.jsx)(z,{value:e,stats:I(a,"drawn_improvement_win_rate",e),label:"IIH",formatter:e=>"".concat((100*e).toFixed(1),"%")})}],[i,c]),[u,x]=(0,r.useState)({column:void 0,direction:"desc"}),[v,f]=(0,r.useState)(new Set(d.map(e=>String(e.accessorKey))));(0,r.useEffect)(()=>{let e=localStorage.getItem("visibleColumns");e&&f(new Set(JSON.parse(e)))},[]);let g=(0,r.useCallback)(e=>{f(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),localStorage.setItem("visibleColumns",JSON.stringify([...a])),a})},[]),p=(0,r.useMemo)(()=>d.filter(e=>v.has(String(e.accessorKey))),[v,d]),b=(0,r.useMemo)(()=>(0,l.jsx)(m,{columns:d,visibleColumns:v,onColumnToggle:g}),[d,v,g]);(0,r.useEffect)(()=>{if(o)return o(b),()=>o(null)},[b,o]);let w=(0,r.useMemo)(()=>u.column?[...t].sort((e,t)=>{let a=e[u.column],l=t[u.column];if(null===a)return 1;if(null===l)return -1;if(a===l)return 0;if("rarity"===u.column){let e=(T[String(a).toLowerCase()]||0)-(T[String(l).toLowerCase()]||0);return"asc"===u.direction?e:-e}if("color"===u.column){let e=U(String(a))-U(String(l));return"asc"===u.direction?e:-e}if(void 0===a)return 1;if(void 0===l)return -1;let r=a<l?-1:1;return"asc"===u.direction?r:-r}):t,[t,u]),j=(0,r.useCallback)(e=>{x(t=>({column:e,direction:t.column===e&&"asc"===t.direction?"desc":"asc"}))},[]);return(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("div",{className:"w-[calc(100vw-2rem)] lg:w-[calc(100vw-4rem)] xl:w-[calc(100vw-6rem)] mx-auto",children:[!o&&(0,l.jsx)("div",{className:"mb-4",children:b}),(0,l.jsx)("div",{className:"card",children:a?(0,l.jsx)("div",{className:"h-96 flex items-center justify-center",children:(0,l.jsx)(n,{text:"正在加载轮抽数据..."})}):(0,l.jsx)(s,{data:w,columns:p,isLoading:!1,emptyText:"暂无卡牌数据",sortColumn:u.column,sortDirection:u.direction,onSort:j,expansion:i})})]})})}function P(){return{formula:"ever_drawn_win_rate",stdDevPerHalfGrade:.33}}function H(){try{let e=localStorage.getItem("customMetricConfig");if(e)return JSON.parse(e)}catch(e){console.error("Failed to load custom metric config:",e)}return null}let Y=[{value:"ever_drawn_win_rate",label:"在手胜率（起手或抽到）",shortLabel:"在手胜率",englishShortLabel:"GIH WR"},{value:"opening_hand_win_rate",label:"起手胜率",shortLabel:"起手胜率",englishShortLabel:"OH WR"},{value:"drawn_win_rate",label:"抽到胜率（第一回合或之后）",shortLabel:"抽到胜率",englishShortLabel:"GD WR"},{value:"drawn_improvement_win_rate",label:"在手胜率提升",shortLabel:"在手胜率提升",englishShortLabel:"IIH"},{value:"custom",label:"自定义指标",shortLabel:"自定义",englishShortLabel:"Custom"}];function q(e){let t=e/2;return[{grade:"A+",minStdDev:t+6*e},{grade:"A",minStdDev:t+5*e},{grade:"A-",minStdDev:t+4*e},{grade:"B+",minStdDev:t+3*e},{grade:"B",minStdDev:t+2*e},{grade:"B-",minStdDev:t+ +e},{grade:"C+",minStdDev:t},{grade:"C",minStdDev:-t},{grade:"C-",minStdDev:-(t+ +e)},{grade:"D+",minStdDev:-(t+2*e)},{grade:"D",minStdDev:-(t+3*e)},{grade:"D-",minStdDev:-(t+4*e)},{grade:"F",minStdDev:-1/0},{grade:"-",minStdDev:-1/0}]}function V(e,t){try{let a={win_rate:"win_rate",play_rate:"play_rate",avg_seen:"avg_seen",avg_pick:"avg_pick",opening_hand_win_rate:"opening_hand_win_rate",drawn_win_rate:"drawn_win_rate",ever_drawn_win_rate:"ever_drawn_win_rate",never_drawn_win_rate:"never_drawn_win_rate",drawn_improvement_win_rate:"drawn_improvement_win_rate",seen_count:"seen_count",pick_count:"pick_count",game_count:"game_count",opening_hand_game_count:"opening_hand_game_count",drawn_game_count:"drawn_game_count",ever_drawn_game_count:"ever_drawn_game_count",never_drawn_game_count:"never_drawn_game_count"},l={},r={};Object.keys(a).forEach(e=>{let n=t[a[e]];"number"==typeof n?(r[e]=n,l[e]=!isNaN(n)&&isFinite(n)?n:0):(r[e]=void 0,l[e]=0)});let n=e.trim();if(a.hasOwnProperty(n)){let e=r[n];if(null==e||isNaN(e)||!isFinite(e))return null;return e}let s=new Set;for(let e of(Object.keys(a).forEach(e=>{RegExp("\\b".concat(e,"\\b"),"g").test(n)&&s.add(e)}),s)){let t=r[e];if(null==t||isNaN(t)||!isFinite(t))return null}let i=n;i=i.replace(/\^/g,"**"),Object.keys(l).forEach(e=>{let t=RegExp("\\b".concat(e,"\\b"),"g");i=i.replace(t,"context.".concat(e))});let o=Function("context","return ".concat(i))(l);if("number"!=typeof o||!isFinite(o)||isNaN(o))return null;return o}catch(e){return console.error("Error evaluating custom formula:",e),null}}let $=["W","U","B","R","G","M","C"],Q={W:"W",U:"U",B:"B",R:"R",G:"G",M:"M",C:"C"};function X(e){var t;let{data:a,allCards:s,metric:i,expansion:o,isLoading:c,customConfig:d,deckQuantities:u}=e,m=(0,r.useMemo)(()=>(function(e,t,a){var l;let r="custom"===t?a||H()||P():null,n=null!=(l=null==r?void 0:r.stdDevPerHalfGrade)?l:.33,s=[],i=[];e.forEach(e=>{let a=null;if("custom"===t&&r)a=V(r.formula,e);else{let l=e[t];a="number"!=typeof l||isNaN(l)?null:l}null!==a&&isFinite(a)&&!isNaN(a)?s.push(e):i.push(e)});let o=[];if(s.length>0){let{mean:e,stdDev:a}=function(e){if(0===e.length)return{mean:0,stdDev:0};let t=e.reduce((e,t)=>e+t,0)/e.length,a=Math.sqrt(e.reduce((e,a)=>e+Math.pow(a-t,2),0)/e.length);return{mean:t,stdDev:a}}(s.map(e=>{if("custom"===t&&r){var a;return null!=(a=V(r.formula,e))?a:0}{let a=e[t];return"number"==typeof a?a:0}}));s.forEach(l=>{let s;if("custom"===t&&r){var i;s=null!=(i=V(r.formula,l))?i:0}else{let e=l[t];s="number"==typeof e?e:0}let c=a>0?(s-e)/a:0,d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.33;for(let a of q(t))if(e>=a.minStdDev)return a.grade;return"F"}(c,n);o.push({...l,grade:d,stdDevFromMean:c,metricValue:s,hasData:!0})})}return i.forEach(e=>{o.push({...e,grade:"-",stdDevFromMean:0,metricValue:0,hasData:!1})}),o})(s&&s.length>0?s:a,i,d),[a,s,i,d]),x=(0,r.useMemo)(()=>{let e=new Set(a.map(e=>e.name));return m.filter(t=>e.has(t.name))},[m,a]),h=(0,r.useMemo)(()=>{var e;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.33,a=new Map;return q(t).forEach(e=>{let{grade:t}=e;a.set(t,[])}),e.forEach(e=>{let t=a.get(e.grade)||[];t.push(e),a.set(e.grade,t)}),Array.from(a.entries()).map(e=>{let[t,a]=e;return{grade:t,cards:a}}).filter(e=>e.cards.length>0)}(x,null!=(e=null==d?void 0:d.stdDevPerHalfGrade)?e:.33)},[x,d]),v=(null==(t=Y.find(e=>e.value===i))?void 0:t.shortLabel)||i,f=(0,r.useMemo)(()=>"custom"!==i&&["ever_drawn_win_rate","opening_hand_win_rate","drawn_win_rate","drawn_improvement_win_rate"].includes(i),[i]);return c?(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)("div",{className:"w-[calc(100vw-2rem)] lg:w-[calc(100vw-4rem)] xl:w-[calc(100vw-6rem)] mx-auto",children:(0,l.jsx)("div",{className:"card h-96 flex items-center justify-center",children:(0,l.jsx)(n,{text:"正在加载轮抽数据..."})})})}):(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("div",{className:"w-[calc(100vw-2rem)] lg:w-[calc(100vw-4rem)] xl:w-[calc(100vw-6rem)] mx-auto space-y-4",children:[(0,l.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,l.jsx)("div",{className:"min-w-[1200px]",children:(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{className:"grid border-b border-[--border]",style:{gridTemplateColumns:"60px repeat(7, minmax(150px, 1fr))"},children:[(0,l.jsx)("div",{className:"px-2 py-3 text-sm font-semibold text-[--foreground] text-center",children:"评分"}),$.map(e=>(0,l.jsx)("div",{className:"px-4 py-3 text-center",children:(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)("div",{className:"\n                          w-8 h-8 rounded-full flex items-center justify-center\n                          card-symbol-".concat(Q[e],"\n                          bg-no-repeat bg-[length:100%_100%]\n                          bg-[--component-background]\n                        ")})})},e))]}),h.map(e=>(0,l.jsx)(J,{grade:e.grade,cards:e.cards,metricLabel:v,expansion:o,isWinRateMetric:f,deckQuantities:u},e.grade))]})})}),(0,l.jsx)("div",{className:"md:hidden space-y-2",children:h.map(e=>(0,l.jsx)(Z,{grade:e.grade,cards:e.cards,metricLabel:v,expansion:o,isWinRateMetric:f,deckQuantities:u},e.grade))})]})})}function J(e){let{grade:t,cards:a,metricLabel:n,expansion:s,isWinRateMetric:i,deckQuantities:o}=e,c=(0,r.useMemo)(()=>{let e={W:[],U:[],B:[],R:[],G:[],M:[],C:[]};return a.forEach(t=>{let a=t.color||"";""===a?e.C.push(t):1===a.length?e[a]&&e[a].push(t):e.M.push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>t.metricValue-e.metricValue)}),e},[a]);return 0===a.length?null:(0,l.jsxs)("div",{className:"grid border-b border-[--border] hover:bg-[--background-hover] transition-colors",style:{gridTemplateColumns:"60px repeat(7, minmax(150px, 1fr))"},children:[(0,l.jsx)("div",{className:"px-2 py-3 flex items-start justify-center",children:(0,l.jsx)("div",{className:"text-lg font-bold",children:t})}),$.map(e=>(0,l.jsx)("div",{className:"px-2 py-3",children:(0,l.jsx)("div",{className:"space-y-1",children:c[e].map((a,r)=>(0,l.jsx)(ee,{card:a,grade:t,metricLabel:n,expansion:s,isWinRateMetric:i,quantity:null==o?void 0:o.get(a.name)},"".concat(a.name,"-").concat(e,"-").concat(r)))})},e))]})}function Z(e){let{grade:t,cards:a,metricLabel:n,expansion:s,isWinRateMetric:i,deckQuantities:o}=e,c=(0,r.useMemo)(()=>[...a].sort((e,t)=>t.metricValue-e.metricValue),[a]);return 0===a.length?null:(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("div",{className:"px-4 py-3 border-b border-[--border]",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:t}),(0,l.jsxs)("div",{className:"text-sm text-[--foreground-muted]",children:[a.length," 张卡牌"]})]})}),(0,l.jsx)("div",{className:"p-2 space-y-2",children:c.map((e,a)=>(0,l.jsx)(ee,{card:e,grade:t,metricLabel:n,expansion:s,isWinRateMetric:i,quantity:null==o?void 0:o.get(e.name)},"".concat(e.name,"-mobile-").concat(a)))})]})}function ee(e){var t;let{card:a,metricLabel:n,expansion:s,isWinRateMetric:i,quantity:o}=e,{chineseCards:c}=(0,x.xp)(),[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)({x:0,y:0}),v=(0,r.useRef)(null),f=(0,r.useRef)(null),g=(0,B.U)("(max-width: 1024px)"),p=(0,r.useMemo)(()=>i?(100*a.metricValue).toFixed(1)+"%":a.metricValue>=1e3?a.metricValue.toFixed(0):a.metricValue>=100?a.metricValue.toFixed(1):a.metricValue>=10?a.metricValue.toFixed(2):a.metricValue.toFixed(3),[a.metricValue,i]),w={mythic:{border:"rgba(191, 68, 39, 0.9)",gradient:"linear-gradient(180deg, rgba(216, 90, 60, 0.95) 0%, rgba(191, 68, 39, 0.95) 100%)",glow:"rgba(191, 68, 39, 0.45)"},rare:{border:"rgba(165, 142, 74, 0.95)",gradient:"linear-gradient(180deg, rgba(192, 169, 107, 0.95) 0%, rgba(165, 142, 74, 0.95) 100%)",glow:"rgba(165, 142, 74, 0.4)"},uncommon:{border:"rgba(112, 120, 131, 0.9)",gradient:"linear-gradient(180deg, rgba(142, 149, 158, 0.95) 0%, rgba(112, 120, 131, 0.95) 100%)",glow:"rgba(112, 120, 131, 0.45)"},common:{border:"rgba(25, 23, 27, 0.95)",gradient:"linear-gradient(180deg, rgba(40, 36, 38, 0.95) 0%, rgba(19, 17, 18, 0.95) 100%)",glow:"rgba(25, 23, 27, 0.5)"}}[(null==(t=a.rarity)?void 0:t.toLowerCase())||""]||{border:"rgba(107,114,128,0.9)",gradient:"linear-gradient(180deg, rgba(156,163,175,0.95) 0%, rgba(107,114,128,0.95) 100%)",glow:"rgba(107,114,128,0.45)"},j=c[a.name],_=(null==j?void 0:j.atomic_official_name)||(null==j?void 0:j.atomic_translated_name)||(null==j?void 0:j.zhs_name),N=b(a.url,null==j?void 0:j.id);return(0,r.useEffect)(()=>(g&&d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset",v.current&&clearTimeout(v.current),f.current&&clearTimeout(f.current)}),[g,d]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"relative rounded border border-[--border] hover:brightness-110 transition-all cursor-pointer overflow-hidden",style:{backgroundImage:N?"url(".concat(N,")"):"none",backgroundSize:"cover",backgroundPosition:"50% 20%",borderLeftColor:w.border,borderLeftWidth:"4px",borderLeftStyle:"solid"},title:a.hasData?"".concat(n,": ").concat(p," | Z-Score: ").concat(a.stdDevFromMean.toFixed(2)):"无数据",onMouseEnter:()=>{!g&&(v.current&&(clearTimeout(v.current),v.current=null),d||(f.current=setTimeout(()=>{u(!0),f.current=null},300)))},onMouseMove:e=>{g||h({x:e.clientX,y:e.clientY})},onMouseLeave:()=>{!g&&(f.current&&(clearTimeout(f.current),f.current=null),d&&(v.current=setTimeout(()=>{u(!1)},200)))},onClick:e=>{if(g){e.preventDefault(),e.stopPropagation();let t=e.currentTarget.getBoundingClientRect();h({x:t.left,y:t.top+window.scrollY}),u(!d)}else{let e=(null==j?void 0:j.id)||(a.url?k(a.url):null);e&&window.open("https://mtgch.com/result?q=id=".concat(e,"&utm_source=shiqidi"),"_blank")}},children:(0,l.jsx)("div",{className:"relative z-1",children:(0,l.jsx)("div",{className:"bg-black/50 pl-2 pr-1.5 py-1.5 hover:bg-black/60 transition-colors",style:{boxShadow:"inset 5px 0 8px -4px ".concat(w.glow)},children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-1",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"text-xs font-medium text-white truncate leading-tight flex items-center gap-1",children:[(0,l.jsx)("span",{children:_||a.name}),o&&o>1&&(0,l.jsxs)("span",{className:"text-[10px] bg-yellow-500/80 text-black px-1 rounded-sm font-bold",children:["x",o]})]}),(0,l.jsx)("div",{className:"text-[10px] text-gray-300 truncate leading-tight",children:a.name})]}),a.hasData&&(0,l.jsx)("div",{className:"flex-shrink-0 flex items-center text-xs font-bold text-white",style:{height:"calc(1em * 1.2 + 0.625rem)"},children:p})]})})})}),(0,l.jsx)(M,{card:a,visible:d,x:m.x,y:m.y,expansion:s,isMobile:g,onClose:()=>u(!1),onMouseEnter:()=>{!g&&v.current&&(clearTimeout(v.current),v.current=null)},onMouseLeave:()=>{g||u(!1)}})]})}var et=a(40885),ea=a(79339),el=a(46874),er=a.n(el);a(79125);var en=a(96145);function es(e){let{startDate:t,endDate:a,onStartDateChange:r,onEndDateChange:n}=e,s=(0,B.U)("(max-width: 1024px)"),i="form-control w-full sm:w-32 bg-[--component-background] border border-[--border] rounded-md px-3 py-2 text-sm text-[--component-foreground] focus:border-[--primary] focus:outline-none focus:ring-1 focus:ring-[--primary]";return(0,l.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,l.jsx)(er(),{selected:t,onChange:e=>e&&r(e),selectsStart:!0,startDate:t,endDate:a,maxDate:a,placeholderText:"开始日期",className:i,withPortal:s,portalId:"date-picker-portal",dateFormat:"yyyy/MM/dd",locale:en.g}),(0,l.jsx)("span",{className:"text-[--component-foreground-muted] shrink-0",children:"–"}),(0,l.jsx)(er(),{selected:a,onChange:e=>e&&n(e),selectsEnd:!0,startDate:t,endDate:a,minDate:t,maxDate:new Date,placeholderText:"结束日期",className:i,withPortal:s,portalId:"date-picker-portal",dateFormat:"yyyy/MM/dd",locale:en.g})]})}var ei=a(69553);function eo(e){let{open:t,onClose:a,children:n,anchor:s}=e,i=(0,r.useRef)(null);if((0,r.useEffect)(()=>{if(!t)return;let e=e=>{let t=e.target,l=document.getElementById("date-picker-portal");(null==l?void 0:l.contains(t))||!i.current||i.current.contains(t)||!s||s.contains(t)||a()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[t,a,s]),!t||!s)return null;let o=s.getBoundingClientRect();return(0,ei.createPortal)((0,l.jsx)("div",{ref:i,className:"fixed z-50 w-[calc(100vw-2rem)] max-w-md bg-[--background] rounded-lg shadow-lg p-4 space-y-4 max-h-[80vh] overflow-y-auto",style:{top:"".concat(o.bottom+8,"px"),left:"50%",transform:"translateX(-50%)"},children:n}),document.body)}var ec=a(47898),ed=a(47395),eu=a(73813);function em(e){let{params:t,onParamsChange:a,onColorFilter:n,selectedColors:s,onRarityFilter:i,selectedRarities:o,onSearchFilter:c,searchText:d}=e,u=(0,ec.H)(t.start_date),m=(0,ec.H)(t.end_date),x=(0,B.U)("(max-width: 1024px)"),[h,v]=(0,r.useState)(!1),f=(0,r.useRef)(null),g=(0,r.useMemo)(()=>new Set((0,eu.rG)()),[]),p=(0,r.useMemo)(()=>[{label:"进行中",options:ed.Id.filter(e=>g.has(e.value))},{label:"未进行",options:ed.Id.filter(e=>!g.has(e.value))}],[g]),b=(0,r.useMemo)(()=>{let e=(0,eu.Ry)(t.expansion);return ed.or.filter(t=>e.includes(t.value))},[t.expansion]),w=e=>{let l=(0,eu.Ry)(e),r={expansion:e};if(!l.includes(t.event_type)&&l.length>0){let e=ed.or.find(e=>l.includes(e.value));e?r.event_type=e.value:r.event_type=l[0]}let n=(0,eu.t)(e);n&&(r.start_date=n.split("T")[0]),a(r)},[j,_]=(0,r.useState)(t),[N,y]=(0,r.useState)(s),[k,S]=(0,r.useState)(o);return(0,l.jsxs)("div",{className:"space-y-4",children:[x?(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(et.p,{placeholder:"搜索卡牌名称...",value:d,onChange:e=>c(e.target.value),className:"flex-1"}),(0,l.jsx)(ea.l,{groups:p,value:t.expansion,onChange:e=>w(e.target.value),title:"系列",className:"w-32 shrink-0"}),(0,l.jsx)("button",{ref:f,onClick:()=>{h?v(!1):(_(t),y(s),S(o),v(!0))},className:"\n              p-2 rounded-md transition-colors shrink-0\n              ".concat(h?"bg-[--primary] text-white":"bg-[--component-background] hover:bg-[--component-background-hover]","\n            "),"aria-label":"显示筛选选项",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:(0,l.jsx)("path",{d:"M10 3.75a2 2 0 10-4 0 2 2 0 004 0zM17.25 4.5a.75.75 0 000-1.5h-5.5a.75.75 0 000 1.5h5.5zM5 3.75a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 01.75.75zM4.25 17a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5h1.5zM17.25 17a.75.75 0 000-1.5h-5.5a.75.75 0 000 1.5h5.5zM9 10a.75.75 0 01-.75.75h-5.5a.75.75 0 010-1.5h5.5A.75.75 0 019 10zM17.25 10.75a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5h1.5zM14 10a2 2 0 10-4 0 2 2 0 004 0zM10 16.25a2 2 0 10-4 0 2 2 0 004 0z"})})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsx)(et.p,{placeholder:"搜索卡牌名称...",value:d,onChange:e=>c(e.target.value),className:"w-full sm:w-64"}),(0,l.jsx)("div",{className:"w-full sm:w-auto",children:(0,l.jsx)(es,{startDate:u,endDate:m,onStartDateChange:e=>a({start_date:e.toISOString().split("T")[0]}),onEndDateChange:e=>a({end_date:e.toISOString().split("T")[0]})})})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 sm:gap-4",children:[(0,l.jsx)(ea.l,{groups:p,value:t.expansion,onChange:e=>w(e.target.value),title:"系列",className:"w-full sm:w-32 shrink-0"}),(0,l.jsx)(ea.l,{options:b,value:t.event_type,onChange:e=>a({event_type:e.target.value}),title:"模式",className:"w-full sm:w-auto sm:min-w-[140px]"}),(0,l.jsx)(ea.l,{options:ed.bf,value:t.user_group,onChange:e=>a({user_group:e.target.value}),title:"用户组",className:"w-full sm:w-auto sm:min-w-[100px]"}),(0,l.jsx)(ea.l,{options:ed.x3,value:t.colors||"",onChange:e=>a({colors:e.target.value}),title:"套牌颜色",className:"w-full sm:w-auto sm:min-w-[120px]"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm text-[--component-foreground-muted] whitespace-nowrap",children:"卡牌颜色:"}),(0,l.jsx)("div",{className:"flex gap-1",children:ed.qW.map(e=>(0,l.jsx)("button",{className:"\n                      w-8 h-8 rounded-full flex items-center justify-center\n                      card-symbol-".concat(e.value,"\n                      bg-no-repeat bg-[length:100%_100%]\n                      ").concat(s.includes(e.value)?"ring-2 ring-[#FFB000] ring-opacity-80":"hover:ring-2 hover:ring-[#FFB000] hover:ring-opacity-50 brightness-75","\n                      bg-[--component-background] hover:bg-[--component-background-hover]\n                      transition-all\n                    "),onClick:()=>{n(s.includes(e.value)?s.filter(t=>t!==e.value):[...s,e.value])}},e.value))})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm text-[--component-foreground-muted] whitespace-nowrap",children:"稀有度:"}),(0,l.jsx)("div",{className:"flex gap-1",children:ed.YV.map(e=>{let a=t.expansion,r=a.toLowerCase().startsWith("y")?"y".concat(a.slice(a.match(/Y\d{0,2}/)[0].length)).toLowerCase():a.toLowerCase();return(0,l.jsx)("button",{className:"\n                        w-8 h-8 rounded-full flex items-center justify-center\n                        ".concat(o.includes(e.value)?"ring-2 ring-[#FFB000] ring-opacity-80":"hover:ring-2 hover:ring-[#FFB000] hover:ring-opacity-50 brightness-75","\n                        transition-all\n                      "),onClick:()=>{i(o.includes(e.value)?o.filter(t=>t!==e.value):[...o,e.value])},title:e.label,children:(0,l.jsx)(R.SetIcon,{set:r,rarity:e.value,size:"2x",style:{backgroundColor:"transparent"}})},e.value)})})]})]})]}),x&&(0,l.jsx)(eo,{open:h,onClose:()=>v(!1),anchor:f.current,children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(es,{startDate:(0,ec.H)(j.start_date),endDate:(0,ec.H)(j.end_date),onStartDateChange:e=>_({...j,start_date:e.toISOString().split("T")[0]}),onEndDateChange:e=>_({...j,end_date:e.toISOString().split("T")[0]})}),(0,l.jsx)(ea.l,{options:b,value:j.event_type,onChange:e=>_({...j,event_type:e.target.value}),title:"模式",className:"w-full"}),(0,l.jsx)(ea.l,{options:ed.bf,value:j.user_group,onChange:e=>_({...j,user_group:e.target.value}),title:"用户组",className:"w-full"}),(0,l.jsx)(ea.l,{options:ed.x3,value:j.colors||"",onChange:e=>_({...j,colors:e.target.value}),title:"套牌颜色",className:"w-full"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("span",{className:"text-sm text-[--component-foreground-muted] whitespace-nowrap",children:"卡牌颜色:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:ed.qW.map(e=>(0,l.jsx)("button",{className:"\n                      w-8 h-8 rounded-full flex items-center justify-center\n                      card-symbol-".concat(e.value,"\n                      bg-no-repeat bg-[length:100%_100%]\n                      ").concat(N.includes(e.value)?"ring-2 ring-[#FFB000] ring-opacity-80":"hover:ring-2 hover:ring-[#FFB000] hover:ring-opacity-50 brightness-75","\n                      bg-[--component-background] hover:bg-[--component-background-hover]\n                      transition-all\n                    "),onClick:()=>{y(N.includes(e.value)?N.filter(t=>t!==e.value):[...N,e.value])}},e.value))})]}),(0,l.jsxs)("div",{className:"flex items-end justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,l.jsx)("span",{className:"text-sm text-[--component-foreground-muted] whitespace-nowrap",children:"稀有度:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:ed.YV.map(e=>{let a=t.expansion,r=a.toLowerCase().startsWith("y")?"y".concat(a.slice(a.match(/Y\d{0,2}/)[0].length)).toLowerCase():a.toLowerCase();return(0,l.jsx)("button",{className:"\n                          w-8 h-8 rounded-full flex items-center justify-center\n                          ".concat(k.includes(e.value)?"ring-2 ring-[#FFB000] ring-opacity-80":"hover:ring-2 hover:ring-[#FFB000] hover:ring-opacity-50 brightness-75","\n                          transition-all\n                        "),onClick:()=>{S(k.includes(e.value)?k.filter(t=>t!==e.value):[...k,e.value])},title:e.label,children:(0,l.jsx)(R.SetIcon,{set:r,rarity:e.value,size:"2x",style:{backgroundColor:"transparent"}})},e.value)})})]}),(0,l.jsx)("button",{onClick:()=>{Object.entries(j).some(e=>{let[a,l]=e;return t[a]!==l})&&a(j),n(N),i(k),v(!1)},className:"px-4 py-2 bg-[--primary] text-white rounded-md hover:bg-[--primary]/90 transition-colors shrink-0",children:"确定"})]})]})})]})}function ex(e){let{set:t}=e;return(0,l.jsx)(R.SetIcon,{set:t,size:"2x"})}var eh=a(4782);function ev(){let[e,t]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let e=()=>{t(window.scrollY>300)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),e)?(0,l.jsx)(i.$,{variant:"secondary",size:"icon",className:"fixed bottom-8 right-8 z-50 rounded-full shadow-lg",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},title:"回到顶部",children:(0,l.jsx)(eh.A,{className:"h-5 w-5"})}):null}function ef(){let[e,t]=(0,r.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>t(!0),title:"查看评分计算说明",className:"h-8 w-8 text-[--foreground-muted] hover:text-[--foreground]",children:(0,l.jsx)(o.A,{className:"h-4 w-4"})}),e&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:()=>t(!1)}),(0,l.jsxs)("div",{className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[calc(100%-2rem)] sm:w-full max-w-2xl max-h-[85vh] sm:max-h-[80vh] bg-[--component-background] rounded-lg shadow-xl z-50 overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[--border]",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-[--foreground]",children:"评分计算说明"}),(0,l.jsx)("button",{onClick:()=>t(!1),className:"text-[--foreground-muted] hover:text-[--foreground] transition-colors",children:(0,l.jsx)(c.A,{className:"h-5 w-5"})})]}),(0,l.jsx)("div",{className:"overflow-y-auto p-4 sm:p-6 flex-1",children:(0,l.jsx)("div",{className:"space-y-3 text-sm leading-relaxed text-[--foreground-muted]",children:(0,l.jsxs)("ul",{className:"list-disc list-inside space-y-2",children:[(0,l.jsxs)("li",{children:["评分视图基于所选胜率指标（在手胜率、起手胜率、抽到胜率或在手胜率提升）计算所有卡牌在该指标上的均值和标准差。 每张卡的评分由其相对于均值的标准差位置决定：",(0,l.jsx)("span",{className:"font-semibold text-[--foreground]",children:"C"})," 等级对应均值附近（-0.165 到 +0.165 个标准差），相邻半级之间相差 ",(0,l.jsx)("span",{className:"font-semibold text-[--foreground]",children:"0.33 个标准差"}),"。 根据我们对用户牌表的分析，这与限制赛社区常见的评分方式最为贴近。"]}),(0,l.jsx)("li",{children:"应用会影响卡牌具体数据的筛选条件（例如：赛制、用户、套牌、日期范围）时，整体分布会被重新计算，等级也会随之重新分配。"}),(0,l.jsx)("li",{children:"对于不会改变卡牌数据的筛选条件（例如：颜色、稀有度），仅会隐藏不符合条件的卡牌，不会影响已计算的评分。"})]})})}),(0,l.jsx)("div",{className:"px-4 py-3 border-t border-[--border] flex justify-end",children:(0,l.jsx)(i.$,{variant:"secondary",size:"sm",onClick:()=>t(!1),children:"我知道了"})})]})]})]})}var eg=a(33623);function ep(e){let{open:t,onClose:a,onSave:n,initialConfig:s}=e,[o,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(.33),[x,h]=(0,r.useState)("0.33"),[v,f]=(0,r.useState)(null),[g,p]=(0,r.useState)(null),b={win_rate:"胜率",play_rate:"使用率",avg_seen:"平均见过位置",avg_pick:"平均选择位置",opening_hand_win_rate:"起手胜率",drawn_win_rate:"抽到胜率",ever_drawn_win_rate:"在手胜率",never_drawn_win_rate:"未抽到胜率",drawn_improvement_win_rate:"在手胜率提升",seen_count:"见过次数",pick_count:"选择次数",game_count:"游戏次数",opening_hand_game_count:"起手数量",drawn_game_count:"抽到数量",ever_drawn_game_count:"总抽到数量",never_drawn_game_count:"未抽到数量"};return((0,r.useEffect)(()=>{if(t){let e=s||P();d(e.formula),m(e.stdDevPerHalfGrade),h(e.stdDevPerHalfGrade.toString()),f(null)}},[t,s]),t)?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:a}),(0,l.jsxs)("div",{className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[calc(100%-2rem)] sm:w-full max-w-2xl max-h-[85vh] sm:max-h-[80vh] bg-[--component-background] rounded-lg shadow-xl z-50 overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[--border]",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-[--foreground]",children:"自定义指标配置"}),(0,l.jsx)("button",{onClick:a,className:"text-[--foreground-muted] hover:text-[--foreground] transition-colors",children:(0,l.jsx)(c.A,{className:"h-5 w-5"})})]}),(0,l.jsx)("div",{className:"overflow-y-auto p-4 sm:p-6 flex-1",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[--foreground]",children:"计算公式"}),(0,l.jsx)("span",{className:"text-xs text-[--foreground-muted]",children:"支持的操作符: +, -, *, /, ^, (, )"})]}),(0,l.jsx)(et.p,{value:o,onChange:e=>{d(e.target.value),f(null)},placeholder:"例如: ever_drawn_win_rate * 0.7 + play_rate * 0.3",className:v?"border-red-500":""}),v&&(0,l.jsx)("p",{className:"mt-1 text-sm text-red-500",children:v}),o.trim()&&(0,l.jsx)("p",{className:"mt-1 text-xs text-[--foreground-muted] font-mono",children:(e=>{if(!e.trim())return"";let t=e;return Object.keys(b).sort((e,t)=>t.length-e.length).forEach(e=>{let a=RegExp("\\b".concat(e,"\\b"),"g");t=t.replace(a,b[e])}),t})(o)}),(0,l.jsxs)("div",{className:"mt-2 border border-[--border] rounded-md overflow-hidden",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>p("fields"===g?null:"fields"),className:"w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-[--foreground] hover:bg-[--background-subtle] transition-colors",children:[(0,l.jsx)("span",{children:"可用字段（共16个）"}),"fields"===g?(0,l.jsx)(eh.A,{className:"h-4 w-4"}):(0,l.jsx)(eg.A,{className:"h-4 w-4"})]}),"fields"===g&&(0,l.jsx)("div",{className:"px-3 py-2 border-t border-[--border] bg-[--background-subtle]",children:(0,l.jsxs)("div",{className:"space-y-2 text-xs text-[--foreground-muted]",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-[--foreground] mb-1",children:"胜率相关（7个）"}),(0,l.jsx)("p",{className:"font-mono text-[11px] leading-relaxed",children:"win_rate, play_rate, opening_hand_win_rate, drawn_win_rate, ever_drawn_win_rate, never_drawn_win_rate, drawn_improvement_win_rate"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-[--foreground] mb-1",children:"轮抽相关（4个）"}),(0,l.jsx)("p",{className:"font-mono text-[11px] leading-relaxed",children:"avg_seen, avg_pick, seen_count, pick_count"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-[--foreground] mb-1",children:"数量相关（5个）"}),(0,l.jsx)("p",{className:"font-mono text-[11px] leading-relaxed",children:"game_count, opening_hand_game_count, drawn_game_count, ever_drawn_game_count, never_drawn_game_count"})]})]})})]}),(0,l.jsxs)("div",{className:"mt-2 border border-[--border] rounded-md overflow-hidden",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>p("note"===g?null:"note"),className:"w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-[--foreground] hover:bg-[--background-subtle] transition-colors",children:[(0,l.jsx)("span",{children:"说明"}),"note"===g?(0,l.jsx)(eh.A,{className:"h-4 w-4"}):(0,l.jsx)(eg.A,{className:"h-4 w-4"})]}),"note"===g&&(0,l.jsx)("div",{className:"px-3 py-2 border-t border-[--border] bg-[--background-subtle]",children:(0,l.jsxs)("ul",{className:"text-xs text-[--foreground-muted] space-y-1.5",children:[(0,l.jsxs)("li",{className:"flex items-start gap-1.5",children:[(0,l.jsx)("span",{className:"text-[--accent] mt-0.5",children:"•"}),(0,l.jsx)("span",{children:"胜率字段使用小数形式（0.xx），例如 0.55 表示 55%，而不是 55"})]}),(0,l.jsxs)("li",{className:"flex items-start gap-1.5",children:[(0,l.jsx)("span",{className:"text-[--accent] mt-0.5",children:"•"}),(0,l.jsx)("span",{children:'如果公式中使用的任何参量为空（无数据），则计算结果为空，该卡牌将被标记为"-"评分'})]})]})})]}),(0,l.jsxs)("div",{className:"mt-2 border border-[--border] rounded-md overflow-hidden",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>p("examples"===g?null:"examples"),className:"w-full flex items-center justify-between px-3 py-2 text-xs font-medium text-[--foreground] hover:bg-[--background-subtle] transition-colors",children:[(0,l.jsx)("span",{children:"示例"}),"examples"===g?(0,l.jsx)(eh.A,{className:"h-4 w-4"}):(0,l.jsx)(eg.A,{className:"h-4 w-4"})]}),"examples"===g&&(0,l.jsx)("div",{className:"px-3 py-2 border-t border-[--border] bg-[--background-subtle]",children:(0,l.jsxs)("div",{className:"space-y-1.5 text-xs text-[--foreground-muted]",children:[(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)("code",{className:"flex-shrink-0 font-mono bg-[--component-background] px-1.5 py-0.5 rounded text-[11px]",children:"ever_drawn_win_rate"}),(0,l.jsx)("span",{className:"text-[--foreground-muted]",children:"单个字段，例如 0.55"})]}),(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)("code",{className:"flex-shrink-0 font-mono bg-[--component-background] px-1.5 py-0.5 rounded text-[11px]",children:"win_rate * 0.6 + play_rate * 0.4"}),(0,l.jsx)("span",{className:"text-[--foreground-muted]",children:"加权组合"})]}),(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)("code",{className:"flex-shrink-0 font-mono bg-[--component-background] px-1.5 py-0.5 rounded text-[11px]",children:"ever_drawn_win_rate ^ 2"}),(0,l.jsx)("span",{className:"text-[--foreground-muted]",children:"幂运算"})]}),(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)("code",{className:"flex-shrink-0 font-mono bg-[--component-background] px-1.5 py-0.5 rounded text-[11px]",children:"(ever_drawn_win_rate - never_drawn_win_rate) * 100"}),(0,l.jsx)("span",{className:"text-[--foreground-muted]",children:"差值计算"})]})]})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-[--foreground] mb-2",children:"每个半级的标准差间隔"}),(0,l.jsx)(et.p,{type:"text",inputMode:"decimal",value:x,onChange:e=>{let t=e.target.value;if(h(t),f(null),""!==t&&"."!==t){let e=parseFloat(t);!isNaN(e)&&e>0&&e<=1&&m(e)}},onBlur:e=>{let t=e.target.value.trim();if(""===t||"."===t)h("0.33"),m(.33);else{let e=parseFloat(t);isNaN(e)||e<=0||e>1?(h("0.33"),m(.33)):(h(e.toFixed(2).replace(/\.?0+$/,"")),m(e))}},placeholder:"0.33"}),(0,l.jsx)("p",{className:"mt-1 text-xs text-[--foreground-muted]",children:"默认值 0.33。数值越小，评级分布越紧凑；数值越大，评级分布越分散。"})]})]})}),(0,l.jsxs)("div",{className:"px-4 py-3 border-t border-[--border] flex justify-end gap-2",children:[(0,l.jsx)(i.$,{variant:"ghost",size:"sm",onClick:a,children:"取消"}),(0,l.jsx)(i.$,{variant:"secondary",size:"sm",onClick:()=>{if(!o.trim())return void f("公式不能为空");if(u<=0||!isFinite(u))return void f("标准差间隔必须大于0");let e={formula:o.trim(),stdDevPerHalfGrade:u};try{localStorage.setItem("customMetricConfig",JSON.stringify(e))}catch(e){console.error("Failed to save custom metric config:",e)}n(e),a()},children:"保存"})]})]})]}):null}function eb(e){let{selectedMetric:t,onMetricChange:a,onCustomConfigChange:n}=e,[s,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{m(H()||P())},[]);let x=(0,r.useMemo)(()=>Y.find(e=>e.value===t),[t]),h=e=>{"custom"===e?d(!0):a(e)};return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"sm:hidden mb-2 flex items-center gap-2",children:[(0,l.jsxs)(i.$,{variant:"secondary",size:"sm",onClick:()=>o(!s),className:"flex-1 flex items-center justify-between bg-[--component-background]",children:[(0,l.jsx)("span",{children:"评分指标"}),(0,l.jsx)("span",{className:"text-xs text-[--foreground-muted]",children:"custom"===t?"自定义":(null==x?void 0:x.englishShortLabel)||""})]}),(0,l.jsx)(ef,{})]}),(0,l.jsxs)("div",{className:"hidden sm:flex sm:items-center sm:gap-3",children:[(0,l.jsxs)("span",{className:"text-sm text-[--component-foreground-muted] flex items-center gap-1",children:["评分指标：",(0,l.jsx)(ef,{})]}),(0,l.jsx)("div",{className:"flex-1 min-w-[240px] overflow-x-auto",children:(0,l.jsx)("div",{className:"flex items-center gap-2 whitespace-nowrap pb-1",children:Y.map(e=>{let a=t===e.value;return(0,l.jsx)("div",{className:"flex items-center gap-1",children:(0,l.jsx)(i.$,{variant:a?"secondary":"ghost",size:"sm",onClick:()=>h(e.value),title:e.label,className:"inline-flex justify-center text-sm rounded-full px-4 border transition-all ".concat(a?"bg-gradient-to-r from-[--accent]/20 to-[--accent]/10 text-[--foreground] border-[--accent]/60 font-medium shadow-sm hover:border-[--accent]":"bg-[--component-background] text-[--foreground-muted] border-[--border] hover:text-[--foreground] hover:border-[--accent]/50"),children:e.shortLabel})},e.value)})})})]}),(0,l.jsx)("div",{className:"sm:hidden ".concat(s?"":"hidden"),children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Y.map(e=>{let a=t===e.value;return(0,l.jsx)(i.$,{variant:a?"secondary":"ghost",size:"sm",onClick:()=>{h(e.value),"custom"!==e.value&&o(!1)},title:e.label,className:"w-full justify-start text-sm rounded-full border transition-all ".concat(a?"bg-gradient-to-r from-[--accent]/20 to-[--accent]/10 text-[--foreground] border-[--accent]/60 font-medium shadow-sm hover:border-[--accent]":"bg-[--component-background] text-[--foreground-muted] border-[--border] hover:text-[--foreground] hover:border-[--accent]/50"),children:e.shortLabel},e.value)})})}),(0,l.jsx)(ep,{open:c,onClose:()=>d(!1),onSave:e=>{m(e),a("custom"),n&&n(e)},initialConfig:u||void 0})]})}let ew=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,l.jsx)("textarea",{className:"flex min-h-[80px] w-full rounded-md border border-[--border] bg-[--component-background] px-3 py-2 text-sm ring-offset-[--background] placeholder:text-[--foreground-muted] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[--ring] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ".concat(a),ref:t,...r})});ew.displayName="Textarea";var ej=a(80972),e_=a(59882);let eN=r.forwardRef((e,t)=>{let{className:a,variant:r="default",...n}=e;return(0,l.jsx)("div",{ref:t,role:"alert",className:"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-[--foreground] ".concat("destructive"===r?"border-red-500/50 text-red-600 dark:border-red-500 [&>svg]:text-red-600 bg-red-50 dark:bg-red-900/10":"bg-[--background-subtle] text-[--foreground]"," ").concat(a),...n})});eN.displayName="Alert";let ey=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,l.jsx)("h5",{ref:t,className:"mb-1 font-medium leading-none tracking-tight ".concat(a),...r})});ey.displayName="AlertTitle";let ek=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,l.jsx)("div",{ref:t,className:"text-sm [&_p]:leading-relaxed ".concat(a),...r})});function eS(e){let{onImport:t,onClear:a,hasImportedDeck:n,cardNameMap:s}=e,[o,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(""),[x,h]=(0,r.useState)(null);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(i.$,{variant:n?"secondary":"ghost",size:"sm",onClick:()=>d(!0),className:"flex items-center gap-2 ".concat(n?"bg-[--accent]/20 text-[--foreground] border border-[--accent]/60 hover:bg-[--accent]/30":""),children:[(0,l.jsx)(ej.A,{className:"w-4 h-4"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:n?"现开模式 √":"现开模式"}),n&&(0,l.jsx)("span",{className:"sm:hidden",children:"√"})]}),o&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:()=>d(!1)}),(0,l.jsxs)("div",{className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[calc(100%-2rem)] sm:w-full max-w-lg h-[600px] max-h-[90vh] bg-[--component-background] rounded-lg shadow-xl z-50 overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[--border] shrink-0",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-[--foreground]",children:"现开模式"}),(0,l.jsx)("p",{className:"text-sm text-[--foreground-muted] mt-1",children:'粘贴你的现开牌表内容。每行一张卡牌，支持 "数量 卡牌名称" 格式。'})]}),(0,l.jsx)("button",{onClick:()=>d(!1),className:"text-[--foreground-muted] hover:text-[--foreground] transition-colors",children:(0,l.jsx)(c.A,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"flex-1 p-4 flex flex-col min-h-0 gap-4",children:[(0,l.jsx)(ew,{placeholder:"Deck\n1 Adventurer's Airship\n1 Adventurer's Inn\n...",className:"flex-1 font-mono text-sm resize-none",value:u,onChange:e=>{m(e.target.value),x&&h(null)}}),x&&(0,l.jsxs)(eN,{variant:"destructive",className:"shrink-0 max-h-[120px] overflow-y-auto",children:[(0,l.jsx)(e_.A,{className:"h-4 w-4"}),(0,l.jsx)(ey,{children:x.isFullFailure?"匹配失败":"部分卡牌未找到"}),(0,l.jsx)(ek,{className:"text-xs mt-1",children:x.isFullFailure?"所有卡牌均未找到，请检查牌表格式或确认系列是否选择正确。":(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("p",{children:"以下卡牌未找到，请检查拼写："}),(0,l.jsx)("div",{className:"font-mono bg-black/10 p-1 rounded",children:x.missingCards.join(", ")})]})})]})]}),(0,l.jsxs)("div",{className:"px-4 py-3 border-t border-[--border] flex justify-end gap-2 shrink-0",children:[(0,l.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:"取消"}),n&&(0,l.jsx)(i.$,{type:"button",variant:"secondary",size:"sm",onClick:()=>{a(),d(!1),m(""),h(null)},children:"清空当前牌表"}),(0,l.jsx)(i.$,{type:"submit",size:"sm",onClick:()=>{if(!u.trim())return;h(null);let e=u.split("\n"),a=e.findIndex(e=>"deck"===e.trim().toLowerCase());-1!==a&&(e=e.slice(a+1)),e=e.filter(e=>e.trim());let l=new Map,r=[];if(e.forEach(e=>{let t=e.trim(),a=1,n=t.match(/^(\d+)[xX]?\s+(.+)$/);n&&(a=parseInt(n[1],10),t=n[2].trim());let i=t.indexOf("//");-1!==i&&(t=t.substring(0,i).trim());let o=t.indexOf(" (");if(-1!==o)t=t.substring(0,o).trim();else{let e=t.indexOf("(");-1!==e&&e<t.length-1&&(t=t.substring(0,e).trim())}let c=t.toLowerCase(),d=s.get(c);d?l.set(d,(l.get(d)||0)+a):r.push(t)}),r.length>0){let t=r.length===e.length;h({missingCards:r,isFullFailure:t});return}t(l),d(!1),h(null)},children:"导入"})]})]})]})]})}function eC(){let{cards:e,params:t,chineseCards:a,isLoading:n,setCards:s,setChineseCards:o,setIsLoading:c,setError:d,setParams:u}=(0,x.xp)(),[m,h]=(0,r.useState)([]),[v,f]=(0,r.useState)([]),[g,p]=(0,r.useState)(""),[b,w]=(0,r.useState)("table"),[j,_]=(0,r.useState)("ever_drawn_win_rate"),[N,k]=(0,r.useState)(null),[S,C]=(0,r.useState)(null),[R,M]=(0,r.useState)(!1),[B,L]=(0,r.useState)(null),O=(0,r.useMemo)(()=>{let t=e;if(B&&(t=t.filter(e=>B.has(e.name))),g){let e=g.toLowerCase();t=t.filter(t=>{let l=t.name.toLowerCase().includes(e),r=a[t.name],n=(null==r?void 0:r.atomic_official_name)||(null==r?void 0:r.atomic_translated_name)||(null==r?void 0:r.zhs_name),s=null==n?void 0:n.toLowerCase().includes(e);return l||s})}return m.length>0&&(t=t.filter(e=>{let t=e.color?e.color.split(""):[],a=t.length>1,l=0===t.length,r=m.includes("M"),n=m.includes("C");if(l&&n)return!0;if(r){if(!a)return!1;let e=m.filter(e=>"WUBRG".includes(e));return!(e.length>0)||e.every(e=>t.includes(e))}let s=m.filter(e=>"WUBRG".includes(e));return s.length>0&&s.some(e=>t.includes(e))})),v.length>0&&(t=t.filter(e=>v.includes(e.rarity.toLowerCase()))),t},[e,g,m,v,a,B]);(0,r.useEffect)(()=>{let e=new AbortController,a=e.signal;return async function(){try{c(!0);let e=await y(t,a);if(a.aborted)return;s(e),c(!1),D(t.expansion,e,e=>{a.aborted||o(e)}).catch(e=>{a.aborted||console.error("Failed to load Chinese card data:",e)})}catch(e){if(a.aborted)return;d(e),c(!1)}}(),()=>{e.abort()}},[t,s,o,c,d]),(0,r.useEffect)(()=>{M(!0);let e=localStorage.getItem("viewMode");e&&w(e);let t=localStorage.getItem("gradeMetric");t&&_(t);let a=H();a&&k(a)},[]),(0,r.useEffect)(()=>{R&&localStorage.setItem("viewMode",b),"table"!==b&&C(null)},[b,R]),(0,r.useEffect)(()=>{R&&localStorage.setItem("gradeMetric",j)},[j,R]);let F=(0,r.useMemo)(()=>{let t=new Map;return e.forEach(e=>{t.set(e.name.toLowerCase(),e.name);let l=a[e.name];l&&(l.zhs_name&&t.set(l.zhs_name.toLowerCase(),e.name),l.atomic_official_name&&t.set(l.atomic_official_name.toLowerCase(),e.name),l.atomic_translated_name&&t.set(l.atomic_translated_name.toLowerCase(),e.name))}),t},[e,a]);return(0,r.useEffect)(()=>{L(null)},[t.expansion]),(0,l.jsxs)("div",{className:"py-8",children:[(0,l.jsxs)("div",{className:"container mx-auto px-4 mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-8",children:[(0,l.jsx)(ex,{set:t.expansion}),(0,l.jsxs)("h1",{className:"text-2xl font-semibold",children:[t.expansion," 轮抽卡牌数据"]}),(0,l.jsxs)("a",{href:"https://www.17lands.com/card_data?utm_source=shiqidi",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-[--accent]/10 text-[--muted-foreground] hover:text-[--foreground] hover:bg-[--accent]/20 transition-colors",children:[(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:[(0,l.jsx)("path",{fillRule:"evenodd",d:"M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5z",clipRule:"evenodd"}),(0,l.jsx)("path",{fillRule:"evenodd",d:"M6.194 12.753a.75.75 0 001.06.053L16.5 4.44v2.81a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5a.75.75 0 000 1.5h2.553l-9.056 8.194a.75.75 0 00-.053 1.06z",clipRule:"evenodd"})]}),"17Lands"]})]}),(0,l.jsx)(em,{params:t,onParamsChange:u,onColorFilter:h,selectedColors:m,onRarityFilter:f,selectedRarities:v,onSearchFilter:p,searchText:g}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-6 p-4 bg-[--component-background] rounded-lg border border-[--border]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 shrink-0 order-1",children:[(0,l.jsxs)(i.$,{variant:"grades"===b?"secondary":"ghost",size:"sm",onClick:()=>w("grades"),className:"flex items-center gap-2",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:(0,l.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})}),"评分视图"]}),(0,l.jsxs)(i.$,{variant:"table"===b?"secondary":"ghost",size:"sm",onClick:()=>w("table"),className:"flex items-center gap-2",children:[(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[(0,l.jsx)("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),(0,l.jsx)("path",{d:"M3 9h18"}),(0,l.jsx)("path",{d:"M8 3v2"}),(0,l.jsx)("path",{d:"M16 3v2"})]}),"表格视图"]})]}),"grades"===b&&(0,l.jsx)("div",{className:"w-full md:w-auto md:flex-1 min-w-[240px] order-3 md:order-2",children:(0,l.jsx)(eb,{selectedMetric:j,onMetricChange:_,onCustomConfigChange:k})}),"table"===b&&S&&(0,l.jsx)("div",{className:"w-full md:w-auto md:flex-1 min-w-[240px] order-3 md:order-2",children:S}),(0,l.jsx)("div",{className:"shrink-0 flex items-center order-2 md:order-3 ml-auto md:ml-0",children:(0,l.jsx)(eS,{onImport:e=>{L(e)},onClear:()=>{L(null)},hasImportedDeck:!!B,cardNameMap:F},t.expansion)})]})]}),"table"===b?(0,l.jsx)(K,{data:O,isLoading:n,expansion:t.expansion,onColumnControlsChange:C,deckQuantities:B||void 0}):(0,l.jsx)(X,{data:O,allCards:e,metric:j,expansion:t.expansion,isLoading:n,customConfig:N||void 0,deckQuantities:B||void 0}),(0,l.jsx)(ev,{})]})}ek.displayName="AlertDescription"}},e=>{e.O(0,[630,591,334,145,491,979,329,76,358],()=>e(e.s=13477)),_N_E=e.O()}]);